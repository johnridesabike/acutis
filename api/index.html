<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Acutis API for JavaScript &amp; ReScript</title>
    
      <meta name="description" content="The manual for the application programming interface for the Acutis template
language.
" />
    
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/style.css" />
    <link rel="icon" href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/icon.svg" type="image/svg+xml" />
    <link rel="icon" href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/favicon.ico" />
  </head>
  <body>
    <a class="skip-nav" href="#content">Skip to content.</a><div class="site-header__wrapper">
        <header class="site-header"><p class="site-header__title">
              <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/">
                <img
                  src="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/icon.svg"
                  height="48"
                  width="48"
                  alt="Acutis icon."
                  style="vertical-align:middle;"
                />
                Acutis
              </a>
            </p><p class="site-header__subtitle">A declarative template language for web documents &amp; beyond.</p>
        </header>
        <nav class="site-header__nav">
          <ol class="site-header__nav-list"><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;" aria-current="false">Home</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;introduction&#x2F;" aria-current="false">Getting started</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;manual&#x2F;" aria-current="false">Language manual</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;api&#x2F;" aria-current="true">API</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;playground&#x2F;" aria-current="false">Playground</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;development&#x2F;" aria-current="false">Development</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;credits&#x2F;" aria-current="false">Credits</a>
              </li></ol>
        </nav>
      </div><main class="main" id="content">
      <article>
          <header class="header">
            <h1>Acutis API for JavaScript &amp; ReScript</h1>
          </header><p>An Acutis template tree is rendered using <em>template source(s)</em>, a <em>props
object</em>, and an <em>environment object</em>,</p>
<p>Template sources are compiled into functions. These functions are then
executed with their props and their environment’s renderer, which produces
the final output.</p>
<p>(Note: This document refers to “objects” due to their representation in
JavaScript. In ReScript, these are either records or dictionaries.)</p>
<p><div class="table-of-contents"><details open><summary class="toc-container-header">Contents</summary><ol><li><a href="#example-code">Example code</a><ol><li><a href="#javascript">JavaScript</a></li><li><a href="#rescript">ReScript</a></li></ol></li><li><a href="#sources">Sources</a><ol><li><a href="#source.string">Source.string</a></li><li><a href="#source.func">Source.func</a></li><li><a href="#source.funcwithstring">Source.funcWithString</a></li></ol></li><li><a href="#compiling">Compiling</a><ol><li><a href="#compile.make">Compile.make</a></li><li><a href="#compile.components.make">Compile.Components.make</a></li><li><a href="#compile.components.empty">Compile.Components.empty</a></li></ol></li><li><a href="#results">Results</a><ol><li><a href="#javascript%3A-%7B-name%2C-val-%7D">JavaScript: { NAME, VAL }</a></li><li><a href="#rescript%3A-%5B%23ok('a)-%7C-%23errors(array%3Cacutis_types.errors.t%3E)%5D">ReScript: [#ok('a) | #errors(array&lt;Acutis_Types.Errors.t&gt;)]</a></li><li><a href="#result.map">Result.map</a></li><li><a href="#result.flatmap">Result.flatMap</a></li><li><a href="#result.getexn">Result.getExn</a></li><li><a href="#result.getorelse">Result.getOrElse</a></li></ol></li><li><a href="#error-messages">Error messages</a></li><li><a href="#template-functions-overview">Template functions overview</a></li><li><a href="#template-component-functions">Template component functions</a></li><li><a href="#environment">Environment</a><ol><li><a href="#environment.sync">Environment.sync</a></li><li><a href="#environment.async">Environment.async</a></li></ol></li><li><a href="#environment-functions">Environment functions</a><ol><li><a href="#render">render</a></li><li><a href="#return">return</a></li><li><a href="#error">error</a></li><li><a href="#mapchild">mapChild</a></li><li><a href="#flatmapchild">flatMapChild</a></li></ol></li><li><a href="#template-function-tips">Template function tips</a><ol><li><a href="#synchronous-and-asynchronous-templates">Synchronous and asynchronous templates</a></li><li><a href="#using-the-children-argument">Using the children argument</a></li></ol></li><li><a href="#node-helpers-api">Node helpers API</a><ol><li><a href="#loadtemplate">loadTemplate</a></li><li><a href="#filenametocomponent">filenameToComponent</a></li></ol></li><li><a href="#acutis-command-line-interface-(cli)">Acutis command line interface (CLI)</a></li></ol></details></div></p>
<h2 id="example-code">Example code</h2>
<h3 id="javascript">JavaScript</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile<span class="token punctuation">,</span> Environment<span class="token punctuation">,</span> Result<span class="token punctuation">,</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> components <span class="token operator">=</span> Compile<span class="token punctuation">.</span>Components<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>  Source<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Footer"</span><span class="token punctuation">,</span> <span class="token string">"Copyright 2021."</span><span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> env <span class="token operator">=</span> Environment<span class="token punctuation">.</span>sync<br><span class="token keyword">const</span> src <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">,</span> <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> template <span class="token operator">=</span> Compile<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> Result<span class="token punctuation">.</span><span class="token function">getExn</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> result <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><br>  template<span class="token punctuation">,</span><br>  <span class="token parameter">template</span> <span class="token operator">=></span> <span class="token function">template</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"Carlo"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br> <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> output <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><br>  result<span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">errors</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"I couldn't render this template."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs: "Hello Carlo."</span></code></pre>
<h3 id="rescript">ReScript</h3>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> components <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span><span class="token class-name">Components</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token class-name">Source</span><span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Footer"</span><span class="token punctuation">,</span> <span class="token string">"Copyright 2021."</span><span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> env <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span>sync<br><span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>fromArray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Carlo"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token class-name">Source</span><span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Main"</span><span class="token punctuation">,</span> <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">)</span><br>  <span class="token operator">-></span><span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token class-name">Result</span><span class="token punctuation">.</span>getExn<span class="token punctuation">(</span>components<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token operator">-></span><span class="token class-name">Result</span><span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>template <span class="token operator">=></span> template<span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token operator">-></span><span class="token class-name">Result</span><span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>errors <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Console</span><span class="token punctuation">.</span>error<span class="token punctuation">(</span>errors<span class="token punctuation">)</span><br>    failwith<span class="token punctuation">(</span><span class="token string">"I couldn't render this template."</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token operator">-></span><span class="token class-name">Js</span><span class="token punctuation">.</span>log <span class="token comment">// Logs: "Hello Carlo."</span></code></pre>
<h2 id="sources">Sources</h2>
<p>The <code>Source</code> module’s functions classify different types of sources to
prepare them for the compiler. They return an internal data type that the
compiler uses.</p>
<p>⚠️ Note: The first <code>name</code> argument for each source will be the name used if
the you include the template as a <a href="../manual/#template-components">component</a>. The compiler currently allows
you to name your templates anything you want, but they must adhere to the
component naming syntax to be usable as components.</p>
<h3 id="source.string"><code>Source.string</code></h3>
<p>The <code>Source.string</code> function accepts the name of a template and the raw
source code in a string.</p>
<h4 id="javascript-example">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> src <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">,</span> <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token class-name">Source</span><span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Main"</span><span class="token punctuation">,</span> <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">)</span></code></pre>
<h3 id="source.func"><code>Source.func</code></h3>
<p>The <code>Source.func</code> function accepts the name of the template and a function.
See <a href="#template-functions-overview">template functions</a> for more information on how these work.</p>
<h4 id="javascript-example-1">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> src <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><br>  <span class="token string">"Main"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-1">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token class-name">Source</span><span class="token punctuation">.</span>func<span class="token punctuation">(</span><br>  <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Main"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span></code></pre>
<h3 id="source.funcwithstring"><code>Source.funcWithString</code></h3>
<p>The <code>Source.funcWithString</code> function accepts the name of the template, the
raw template source as a string, and a function which accepts the compiled
template and returns a template function. See <a href="#template-functions-overview">template functions</a> for more
on how these work.</p>
<p>This is useful if you have a regular string template, but you want to wrap it
in some custom runtime logic.</p>
<h4 id="javascript-example-2">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> src <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">funcWithString</span><span class="token punctuation">(</span><br>  <span class="token string">"Main"</span><span class="token punctuation">,</span><br>  <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">ast</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-2">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token class-name">Source</span><span class="token punctuation">.</span>funcWithString<span class="token punctuation">(</span><br>  <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Main"</span><span class="token punctuation">,</span><br>  <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span>ast<span class="token punctuation">,</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">.</span> ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br><span class="token punctuation">)</span></code></pre>
<h2 id="compiling">Compiling</h2>
<p>Once you classify a template source through one of the <code>Source</code> functions,
the next step is compiling it.</p>
<h3 id="compile.make"><code>Compile.make</code></h3>
<p>The <code>Compile.make</code> function compiles a source and its components into a
<a href="#results">result</a> of a template function. See <a href="#results">results</a> and <a href="#template-functions-overview">template functions</a> to
read about how these work.</p>
<h4 id="javascript-example-3">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile<span class="token punctuation">,</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> components <span class="token operator">=</span> Compile<span class="token punctuation">.</span>Components<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> src <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">,</span> <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> templateResult <span class="token operator">=</span> Compile<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> components<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-3">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> components <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span><span class="token class-name">Components</span><span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token class-name">Source</span><span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Main"</span><span class="token punctuation">,</span> <span class="token string">"Hello {{ name }}"</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> templateResult <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span>src<span class="token punctuation">,</span> components<span class="token punctuation">)</span></code></pre>
<h3 id="compile.components.make"><code>Compile.Components.make</code></h3>
<p>The <code>Compile.Components.make</code> function accepts an array of <a href="#sources">sources</a> and
returns a <a href="#results">result</a> of their compiled output.</p>
<h4 id="javascript-example-4">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile<span class="token punctuation">,</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> header <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Header"</span><span class="token punctuation">,</span> <span class="token string">"&lt;h1>Hello&lt;/h1>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> footer <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Footer"</span><span class="token punctuation">,</span> <span class="token string">"Copyright 2021 Carlo."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> componentsResult <span class="token operator">=</span> Compile<span class="token punctuation">.</span>Components<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span>header<span class="token punctuation">,</span> footer<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<h4 id="rescript-example-4">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> header <span class="token operator">=</span> <span class="token class-name">Source</span><span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Header"</span><span class="token punctuation">,</span> <span class="token string">"&lt;h1>Hello&lt;/h1>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> footer <span class="token operator">=</span> <span class="token class-name">Source</span><span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Footer"</span><span class="token punctuation">,</span> <span class="token string">"Copyright 2021 Carlo."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> componentsResult <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span><span class="token class-name">Components</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token punctuation">[</span>header<span class="token punctuation">,</span> footer<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<h3 id="compile.components.empty"><code>Compile.Components.empty</code></h3>
<p>If you aren’t using components, or you need a placeholder, then the
<code>Compile.Components.empty</code> function will return an empty components value.</p>
<p>Running <code>Compile.Components.empty()</code> is equivalent to
<code>Compile.Components.make([])</code>. It’s just slightly more efficient.</p>
<h2 id="results">Results</h2>
<p>Acutis handles errors with a “result” data type. This is represented in
JavaScript as an object and in ReScript as a <a href="https://rescript-lang.org/docs/manual/latest/polymorphic-variant">polymorphic variant</a>. It will
either contain a function’s successful output, or it will contain an array of
errors.</p>
<p>You can either access these values manually, or use the included utility
functions.</p>
<h3 id="javascript%3A-%7B-name%2C-val-%7D">JavaScript: <code>{ NAME, VAL }</code></h3>
<p>Acutis returns data inside an object with <code>NAME</code> and <code>VAL</code> properties. If any
errors occurred, then <code>NAME</code> will be <code>&quot;errors&quot;</code> and <code>VAL</code> will be an array of
the errors. If no errors occurred, then <code>NAME</code> will be <code>&quot;ok&quot;</code> and <code>VAL</code> will
be the rendered output.</p>
<h4 id="example-successful-output">Example successful output</h4>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"NAME"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span><br>  <span class="token property">"VAL"</span><span class="token operator">:</span> <span class="token string">"The content of your output."</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="example-unsuccessful-output">Example unsuccessful output</h4>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"NAME"</span><span class="token operator">:</span> <span class="token string">"errors"</span><span class="token punctuation">,</span><br>  <span class="token property">"VAL"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Error details goes here."</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="example-usage">Example usage</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">NAME</span> <span class="token operator">===</span> <span class="token string">"errors"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">VAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">VAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="rescript%3A-%5B%23ok('a)-%7C-%23errors(array%3Cacutis_types.errors.t%3E)%5D">ReScript: <code>[#ok('a) | #errors(array&lt;Acutis_Types.Errors.t&gt;)]</code></h3>
<p>In ReScript, the output uses a polymorphic variant defined as <code>[#ok('a) | #errors(array&lt;Acutis_Types.Errors.t&gt;)]</code>. You can use <code>switch</code> with it like
any variant.</p>
<p>This is conceptually the same as the standard <a href="https://rescript-lang.org/docs/manual/latest/api/belt/result">ReScript result type</a>. We’re
using a custom polymorphic variant because of its nicer JavaScript
representation.</p>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">switch</span> result <span class="token punctuation">{</span><br><span class="token operator">|</span> <span class="token operator">#</span>ok<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span><br><span class="token operator">|</span> <span class="token operator">#</span>errors<span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Console</span><span class="token punctuation">.</span>error<span class="token punctuation">(</span>errors<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="result.map"><code>Result.map</code></h3>
<p>The <code>Result.map</code> function accepts a result and a function that accepts its
contents and returns a new value. The given function only executes if the
result does not have errors.</p>
<h4 id="javascript-example-5">JavaScript Example</h4>
<pre class="language-js"><code class="language-js"><span class="token comment">// Assume props and children are already defined.</span><br><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>Environment<span class="token punctuation">.</span>sync<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> resultALLCAPS <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token parameter">x</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-5">ReScript Example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token comment">// Assume props and children are already defined.</span><br><span class="token keyword">let</span> result <span class="token operator">=</span> template<span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span>sync<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br><span class="token keyword">let</span> resultALLCAPS <span class="token operator">=</span> <span class="token class-name">Result</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">String</span><span class="token punctuation">.</span>toUpperCase<span class="token punctuation">)</span></code></pre>
<h3 id="result.flatmap"><code>Result.flatMap</code></h3>
<p>The <code>Result.flatMap</code> function works almost identically to <code>Result.map</code>,
except that the given function must <em>return another <code>result</code></em>.</p>
<h4 id="example">Example</h4>
<p>We can write the JavaScript and ReScript example identically.</p>
<pre class="language-reason"><code class="language-reason"><span class="token comment">// Assume src, components, props, and children is defined already</span><br><span class="token keyword">let</span> templateResult <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span>src<span class="token punctuation">,</span> components<span class="token punctuation">)</span><br><span class="token keyword">let</span> outputResult <span class="token operator">=</span> <span class="token class-name">Result</span><span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span><br>  templateResult<span class="token punctuation">,</span><br>  <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token operator">=></span> template<span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span>sync<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br><span class="token punctuation">)</span></code></pre>
<h3 id="result.getexn"><code>Result.getExn</code></h3>
<p>The <code>Result.getExn</code> function returns the value of the result if there are no
errors, and raises an exception if there are errors.</p>
<p>The exception raised is a ReScript exception, which doesn’t always play
nicely with JavaScript tooling. Often, you’ll want to use the more flexible
<code>Result.getOrElse</code> function instead.</p>
<h4 id="example-1">Example</h4>
<p>We can write the JavaScript and ReScript example identically.</p>
<pre class="language-reason"><code class="language-reason"><span class="token comment">// Raises an exception if the result has errors.</span><br><span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token class-name">Result</span><span class="token punctuation">.</span>getExn<span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre>
<h3 id="result.getorelse"><code>Result.getOrElse</code></h3>
<p>The <code>Result.getOrElse</code> function returns the value of the result if there are no
errors, and executes a given function if there are errors.</p>
<p>This can be useful for either getting a “default” value, or doing something
with the errors (such as logging them to the console).</p>
<h4 id="javascript-example-6">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> output <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">getOrElse</span><span class="token punctuation">(</span><br>  result<span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">errors</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token string">"Some default value."</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-6">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token class-name">Result</span><span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span><br>  result<span class="token punctuation">,</span><br>  <span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Console</span><span class="token punctuation">.</span>error<span class="token punctuation">(</span>errors<span class="token punctuation">)</span><br>    <span class="token string">"Some default value."</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span></code></pre>
<h2 id="error-messages">Error messages</h2>
<p>In either language, errors are represented the same. Here’s an example error
message:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"Render"</span><span class="token punctuation">,</span><br>  <span class="token property">"location"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"character"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"\"a\" is type null. I can only echo strings and numbers."</span><span class="token punctuation">,</span><br>  <span class="token property">"path"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token string">"ChildTemplate"</span><span class="token punctuation">,</span><br>    <span class="token string">"match"</span><span class="token punctuation">,</span><br>    <span class="token string">"MainTemplate"</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>Any of these fields may not be present if there isn’t any data for them. If
an exception was thrown while rendering, then it will be caught and added to
an <code>exn</code> field.</p>
<p>When Acutis encounters an error, it will try to keep processing the template
and report as many errors as it can find. But as long as there is at least
one error, then it won’t return any rendered data.</p>
<h2 id="template-functions-overview">Template functions overview</h2>
<p>Templates returned by <code>Compile.make</code> are functions that accept three
arguments:</p>
<ol>
<li>An environment object created by <code>Environment.make</code>.</li>
<li>A props object.</li>
<li>A children object.</li>
</ol>
<p>In ReScript, the environment is a <a href="https://rescript-lang.org/docs/manual/latest/record">record</a>, and props and children are both
<a href="https://rescript-lang.org/docs/manual/latest/api/js/dict">JS dictionary objects</a>.</p>
<p>The children argument is similar to the props, except it contains rendered
template sections. You’ll typically pass an empty object (<code>{}</code>) to this from
your top-level template. See <a href="#using-the-children-argument">using the <code>children</code> argument</a> for more
information about this.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="template-component-functions">Template component functions</h2>
<p>Because templates are just functions, we can write them manually with custom
JavaScript. Any functions we write will need to adhere to the same signature
as the functions created by <code>Compile.make</code>.</p>
<p>Suppose we want a <code>Footer</code> template that will always display the current
year. We can write a template to similar to the following.</p>
<h4 id="javascript-example-7">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> footer <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">funcWithString</span><span class="token punctuation">(</span><br>  <span class="token string">"Footer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Copyright {{ year }}"</span><br>  <span class="token punctuation">(</span><span class="token parameter">ast</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span> year <span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-7">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> footer <span class="token operator">=</span> <br>  <span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Source</span><span class="token punctuation">.</span>funcWithString<span class="token punctuation">(</span><br>    <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Footer"</span><span class="token punctuation">,</span><br>    <span class="token string">"Copyright {{ year }}"</span><br>    <span class="token punctuation">(</span>ast<span class="token punctuation">,</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>set<span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">.</span>getFullYear<span class="token punctuation">)</span><br>      env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">.</span> ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">)</span></code></pre>
<h2 id="environment">Environment</h2>
<p>An environment is an object that contains logic that is global across all
levels of a template tree.</p>
<h3 id="environment.sync"><code>Environment.sync</code></h3>
<p>If you use <code>Environment.sync</code>, then your templates will render as <a href="#results">results</a>
of strings.</p>
<h3 id="environment.async"><code>Environment.async</code></h3>
<p>This works identically to <code>Environment.sync</code>, except except that its render
functions each return a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> of a <a href="#results">result</a> of a string. Use this if you
have <a href="#template-functions-overview">template functions</a> that require asynchronous logic.</p>
<p>If you don’t need asynchronous template component functions, then
<code>Environment.sync</code> is a bit faster, since it doesn’t need to allocate a bunch
of Promises.</p>
<h2 id="environment-functions">Environment functions</h2>
<p>Each environment object contains functions for returning rendered template
contents.</p>
<p>⚠️ In ReScript, environment functions are <a href="https://rescript-lang.org/docs/manual/latest/function#uncurried-function">uncurried</a>.</p>
<h3 id="render"><code>render</code></h3>
<p>The <code>render</code> function processes compiled templates.</p>
<h4 id="javascript-example-8">JavaScript example</h4>
<pre class="language-js"><code class="language-js">Source<span class="token punctuation">.</span><span class="token function">funcWithString</span><span class="token punctuation">(</span><br>  <span class="token string">"Footer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Copyright {{ year }}"</span><br>  <span class="token punctuation">(</span><span class="token parameter">ast</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span> year <span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-8">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Source</span><span class="token punctuation">.</span>funcWithString<span class="token punctuation">(</span><br>  <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Footer"</span><span class="token punctuation">,</span><br>  <span class="token string">"Copyright {{ year }}"</span><br>  <span class="token punctuation">(</span>ast<span class="token punctuation">,</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>set<span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">.</span>getFullYear<span class="token punctuation">)</span><br>    env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">.</span> ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span></code></pre>
<h3 id="return"><code>return</code></h3>
<p>The <code>return</code> function returns a string as-is, wrapped inside the result type.
This is useful if you don’t need the Acutis language features for a
component.</p>
<h4 id="javascript-example-9">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> sayHi <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><br>  <span class="token string">"SayHi"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">"Hello."</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-9">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> sayHi <span class="token operator">=</span><br>  <span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Source</span><span class="token punctuation">.</span>func<span class="token punctuation">(</span><br>    <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"SayHi"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span></code></pre>
<h3 id="error"><code>error</code></h3>
<p>The <code>error</code> function returns an error with the given message. This will cause
the template to fail to render.</p>
<h4 id="javascript-example-10">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fail <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><br>  <span class="token string">"Fail"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"This always fails."</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-10">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> fail <span class="token operator">=</span><br>  <span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Source</span><span class="token punctuation">.</span>func<span class="token punctuation">(</span><br>    <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Fail"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">"This always fails."</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span></code></pre>
<h3 id="mapchild"><code>mapChild</code></h3>
<p>The <code>mapChild</code> function takes a child prop and a callback to transform the
child’s contents. It returns a new child and does not mutate the original. If
the child has an error, then <code>mapChild</code> has no effect.</p>
<p>Template children are valid return types (each one is a fully rendered
template). So they can either be returned as your template or passed to the
children argument of <code>environment.render</code>.</p>
<h4 id="javascript-example-11">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> shout <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><br>  <span class="token string">"Shout"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Children<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">mapChild</span><span class="token punctuation">(</span>Children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-11">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> shout <span class="token operator">=</span><br>  <span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Source</span><span class="token punctuation">.</span>func<span class="token punctuation">(</span><br>    <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Shout"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>      <span class="token keyword">switch</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token string">"Children"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token operator">|</span> <span class="token constructor variable">Some</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">=></span><br>        env<span class="token punctuation">.</span>mapChild<span class="token punctuation">(</span><span class="token punctuation">.</span> children<span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">String</span><span class="token punctuation">.</span>toUpperCase<span class="token punctuation">)</span><br>      <span class="token operator">|</span> <span class="token constructor variable">None</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">""</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>  <span class="token punctuation">)</span></code></pre>
<h3 id="flatmapchild"><code>flatMapChild</code></h3>
<p>The <code>flatMapChild</code> function works similarly to <code>mapChild</code> except that it does
not automatically wrap the returned data. When using <code>flatMapChild</code>, you’re
responsible for wrapping the output with <code>environment.return</code> in your
callback. This means that you can choose to use <code>environment.error</code> instead
to represent failures.</p>
<h4 id="javascript-example-12">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Source <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// assume we already defined a function called somethingThatThrows</span><br><span class="token keyword">const</span> src <span class="token operator">=</span> Source<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><br>  <span class="token string">"Template"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">flatMapChild</span><span class="token punctuation">(</span>Children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">contents</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">try</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token function">somethingThatThrows</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-12">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token comment">// assume we already defined a function called somethingThatThrows</span><br><span class="token keyword">let</span> src <span class="token operator">=</span><br>  <span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Source</span><span class="token punctuation">.</span>func<span class="token punctuation">(</span><br>    <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Template"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>      env<span class="token punctuation">.</span>flatMapChild<span class="token punctuation">(</span><span class="token punctuation">.</span><br>        <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>unsafeGet<span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token string">"Children"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        contents <span class="token operator">=></span><br>          <span class="token keyword">switch</span> somethingThatThrows<span class="token punctuation">(</span>contents<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token operator">|</span> result <span class="token operator">=></span> env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> result<span class="token punctuation">)</span><br>          <span class="token operator">|</span> <span class="token keyword">exception</span> <span class="token constructor variable">Failure</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">.</span> message<span class="token punctuation">)</span><br>          <span class="token punctuation">}</span><br>      <span class="token punctuation">)</span><br>  <span class="token punctuation">)</span></code></pre>
<h2 id="template-function-tips">Template function tips</h2>
<h3 id="synchronous-and-asynchronous-templates">Synchronous and asynchronous templates</h3>
<p>If you have a template function that uses <code>async</code> functions or promises, then
you need to render your whole template tree with an asynchronous environment.</p>
<p>Templates components inherit their environment from their parent templates,
so synchronous templates can be used interchangeably between environment
types. This does not work the other way around, though. Asynchronous
templates cannot be made synchronous.</p>
<h3 id="using-the-children-argument">Using the children argument</h3>
<p><a href="../manual/#template-children-props">Template components can accept template sections as children props</a>, but
these are not interchangeable with pattern props. Therefore, Acutis keeps
rendered template children in a separate object.</p>
<p>You will usually not need to directly manipulate the children argument, or
often you can just pass an empty object (<code>{}</code>) as children.</p>
<p>If you are manually rendering a template section within a function, then make
sure you pass it to the children argument.</p>
<h2 id="node-helpers-api">Node helpers API</h2>
<p>Acutis includes functions for rendering templates in a Node.js environment,
such as for a static site generator. They can be imported from module
<code>acutis-lang/node-utils</code>.</p>
<h3 id="loadtemplate"><code>loadTemplate</code></h3>
<p>Calling <code>loadTemplate(fileName)</code> will return a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> of a template
function.</p>
<p>If the filename ends with a <code>.js</code> or <code>.mjs</code> extension, then it will load it
with dynamic <code>import</code>. It uses the “default” export as the template source.</p>
<p>For all other file extension, it loads the file’s text content as the
template.</p>
<h3 id="filenametocomponent"><code>filenameToComponent</code></h3>
<p>Calling <code>filenameToComponent(fileName)</code> strips the extension and capitalizes
the first letter. Example: <code>filenameToComponent(&quot;footer.js&quot;)</code> returns
<code>&quot;Footer&quot;</code>. This is just a convenience to help components adhere to template
naming rules.</p>
<h2 id="acutis-command-line-interface-(cli)">Acutis command line interface (CLI)</h2>
<p>You can use Acutis from the command line. It accepts JSON data and an array
of template filenames, and it prints the rendered output.</p>
<pre class="language-shell"><code class="language-shell">acutis Index.acutis src/**/*.<span class="token punctuation">(</span>js<span class="token operator">|</span>mjs<span class="token operator">|</span>acutis<span class="token punctuation">)</span> <span class="token operator">&lt;</span> data.json <span class="token operator">></span> dist/index.html</code></pre>
<p>Full options:</p>
<pre class="language-html"><code class="language-html">Usage:<br>  acutis [options] [template] [templates...]<br><br>Options:<br>  -a, --async                   Enable asynchronous templates. Default: false.<br>  -d, --data                    The path to the JSON data file. Default: stdin.<br>  -o, --output                  The path to write the output. Default: stdout.<br>  -t, --table                   Print errors in a table. Default: false.<br>  -h, --help                    Show this message and exit.<br>  -v, --version                 Show the version and exit.<br><br>Templates:<br>  The first template listed is the root template. Templates with .js, .mjs,<br>  or .cjs extensions are rendered using their default export. For all other<br>  file types, their text content is used as the template.<br><br>Examples:<br>  acutis --data=data.json --output=index.html Index.acutis Header.js Footer.acutis<br>  acutis Index.acutis _includes/**/*.(js|mjs|acutis) &lt; data.json > index.html<br>  curl https://example.com/api | acutis Index.acutis *.(js|acutis) -o index.html</code></pre>

      </article>
    </main><footer class="footer">
  <p>
    Published in 2021 by <a href="https:&#x2F;&#x2F;johnridesa.bike">John Jackson</a>.
  </p>
  <p class="footer__license">
    <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/license/">View the license</a>.
  </p>
</footer>
</body>
</html>