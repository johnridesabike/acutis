<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Acutis API for JavaScript &amp; ReScript</title>
    
      <meta name="description" content="The manual for the application programming interface for the Acutis template
language.
" />
    
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/style.css" />
  </head>
  <body>
    <a class="skip-nav" href="#content">Skip to content.</a><div class="site-header__wrapper">
        <header><p class="site-header__title">
              <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/">Acutis</a>
            </p><p class="site-header__subtitle">A declarative template language for web documents &amp; beyond.</p>
        </header>
        <nav class="site-header__nav">
          <ol class="site-header__nav-list"><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;" aria-current="false">
  Home
</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;introduction&#x2F;" aria-current="false">
  Getting started
</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;manual&#x2F;" aria-current="false">
  Language manual
</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;api&#x2F;" aria-current="true">
  API
</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;playground&#x2F;" aria-current="false">
  Playground
</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;development&#x2F;" aria-current="false">
  Development
</a>
              </li><li>
                <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis&#x2F;credits&#x2F;" aria-current="false">
  Credits
</a>
              </li></ol>
        </nav>
      </div><main class="main" id="content">
      <article>
          <header class="header">
            <h1>Acutis API for JavaScript &amp; ReScript</h1>
          </header><p>An Acutis template tree is rendered using a <em>template source</em>, a <em>props
object</em>, an <em>environment object</em>, and an <em>object with template components</em>.</p>
<p>Template sources are compiled into functions. These functions are then
executed with their props and their environment’s renderer, which produces
the final output.</p>
<p>(Note: This document refers to “objects” due to their representation in
JavaScript. In ReScript, these are records or dictionaries.)</p>
<p><div class="table-of-contents"><details open><summary class="toc-container-header">Contents</summary><ol><li><a href="#example-code">Example code</a><ol><li><a href="#javascript">JavaScript</a></li><li><a href="#rescript">ReScript</a></li></ol></li><li><a href="#function-reference">Function reference</a><ol><li><a href="#compile.make">Compile.make</a></li><li><a href="#environment.make">Environment.make</a></li><li><a href="#environment.async.make">Environment.Async.make</a></li></ol></li><li><a href="#how-to-handle-the-output">How to handle the output</a><ol><li><a href="#javascript%3A-%7B-name%2C-val-%7D">JavaScript: { NAME, VAL }</a></li><li><a href="#rescript%3A-%5B%23data('a)-%7C-%23errors('e)%5D">ReScript: [#data('a) | #errors('e)]</a></li><li><a href="#handling-errors">Handling errors</a></li></ol></li><li><a href="#template-functions-overview">Template functions overview</a></li><li><a href="#template-component-functions">Template component functions</a><ol><li><a href="#compile.makeast">Compile.makeAst</a></li></ol></li><li><a href="#the-environment-functions">The environment functions</a><ol><li><a href="#environment.render">environment.render</a></li><li><a href="#environment.return">environment.return</a></li><li><a href="#environment.error">environment.error</a></li><li><a href="#environment.mapchild">environment.mapChild</a></li><li><a href="#environment.flatmapchild">environment.flatMapChild</a></li></ol></li><li><a href="#template-function-tips">Template function tips</a><ol><li><a href="#synchronous-and-asynchronous-templates">Synchronous and asynchronous templates</a></li><li><a href="#using-the-children-argument">Using the children argument</a></li></ol></li><li><a href="#node-helpers-api">Node helpers API</a><ol><li><a href="#loadtemplate">loadTemplate</a></li><li><a href="#filenametocomponent">filenameToComponent</a></li></ol></li><li><a href="#acutis-command-line-interface-(cli)">Acutis command line interface (CLI)</a></li></ol></details></div></p>
<h2 id="example-code">Example code</h2>
<h3 id="javascript">JavaScript</h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile<span class="token punctuation">,</span> Environment <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> template <span class="token operator">=</span> Compile<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">"Hello {{ name }}."</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> footer <span class="token operator">=</span> Compile<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">"Copyright 2021."</span><span class="token punctuation">,</span> <span class="token string">"Footer"</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> env <span class="token operator">=</span> Environment<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Footer<span class="token operator">:</span> footer<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">"Carlo"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">NAME</span> <span class="token operator">===</span> <span class="token string">"errors"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">VAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">VAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Logs: "Hello Carlo."</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="rescript">ReScript</h3>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token string">"Hello {{ name }}."</span><span class="token punctuation">,</span> __FILE__<span class="token punctuation">)</span><br><span class="token keyword">let</span> footer <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token string">"Copyright 2021."</span><span class="token punctuation">,</span> <span class="token string">"Footer"</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> env <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>fromArray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"Footer"</span><span class="token punctuation">,</span> footer<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>fromArray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Carlo"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">switch</span> template<span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token operator">|</span> <span class="token operator">#</span>data<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// Logs: "Hello Carlo."</span><br><span class="token operator">|</span> <span class="token operator">#</span>errors<span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Console</span><span class="token punctuation">.</span>error<span class="token punctuation">(</span>errors<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="function-reference">Function reference</h2>
<h3 id="compile.make"><code>Compile.make</code></h3>
<p>The <code>Compile.make</code> function compiles a string into a template function. It
can optionally accept a string name for debugging. See <a href="#template-functions-overview">template
functions</a> to read about how these work.</p>
<h4 id="javascript-example">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> template <span class="token operator">=</span> Compile<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">"Hello {{ name }}."</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token string">"Hello {{ name }}."</span><span class="token punctuation">,</span> <span class="token operator">~</span>name<span class="token operator">=</span>__FILE__<span class="token punctuation">)</span></code></pre>
<p>⚠️ In ReScript, the function returned by <code>Compile.make</code> is <a href="https://rescript-lang.org/docs/manual/latest/function#uncurried-function">uncurried</a>.</p>
<h3 id="environment.make"><code>Environment.make</code></h3>
<p>The <code>Environment.make</code> function accepts an object with all of the template
components. This makes our template components global across all templates in
the render tree. It returns an object with functions used to render compiled
templates.</p>
<h4 id="javascript-example-1">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile<span class="token punctuation">,</span> Environment <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token punctuation">{</span><br>  Footer<span class="token operator">:</span> Compile<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">"Copyright 2021."</span><span class="token punctuation">,</span> <span class="token string">"Footer"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> env <span class="token operator">=</span> Environment<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="rescript-example-1">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> components <span class="token operator">=</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>fromArray<span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token punctuation">(</span><span class="token string">"Footer"</span><span class="token punctuation">,</span> <span class="token class-name">Compile</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token string">"Copyright 2021."</span><span class="token punctuation">,</span> <span class="token operator">~</span>name<span class="token operator">=</span><span class="token string">"Footer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> env <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span>components<span class="token punctuation">)</span></code></pre>
<h3 id="environment.async.make"><code>Environment.Async.make</code></h3>
<p>The functions returned by <code>Environment.Async.make</code> work identically to
<code>Environment.make</code> except that they each return a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. Use this if you
have <a href="#template-functions-overview">template functions</a> that require asynchronous logic.</p>
<h2 id="how-to-handle-the-output">How to handle the output</h2>
<p>The data returned by a template can either contain the rendered output or an
array of error messages. How you use this data will be different depending on
whether you’re using JavaScript or ReScript.</p>
<p>If you’re using asynchronous templates, then the output will always be
wrapped inside a resolved promise. Acutis makes sure that promises never
reject since it captures any errors inside the output.</p>
<h3 id="javascript%3A-%7B-name%2C-val-%7D">JavaScript: <code>{ NAME, VAL }</code></h3>
<p>Acutis returns data inside an object with <code>NAME</code> and <code>VAL</code> properties. If any
errors occurred, then <code>NAME</code> will be <code>&quot;errors&quot;</code> and <code>VAL</code> will be an array of
the errors. If no errors occurred, then <code>NAME</code> will be <code>&quot;data&quot;</code> and <code>VAL</code> will
be the rendered output.</p>
<h4 id="example-successful-output">Example successful output</h4>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"NAME"</span><span class="token operator">:</span> <span class="token string">"data"</span><span class="token punctuation">,</span><br>  <span class="token property">"VAL"</span><span class="token operator">:</span> <span class="token string">"The content of your output."</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="example-unsuccessful-output">Example unsuccessful output</h4>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"NAME"</span><span class="token operator">:</span> <span class="token string">"errors"</span><span class="token punctuation">,</span><br>  <span class="token property">"VAL"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"An object with error details goes here."</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="example-usage">Example usage</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">NAME</span> <span class="token operator">===</span> <span class="token string">"errors"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">VAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token constant">VAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="rescript%3A-%5B%23data('a)-%7C-%23errors('e)%5D">ReScript: <code>[#data('a) | #errors('e)]</code></h3>
<p>In ReScript, the output uses a polymorphic variant defined as <code>[#data('a) | #errors('e)]</code>. You can use <code>switch</code> with it like any variant.</p>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">switch</span> result <span class="token punctuation">{</span><br><span class="token operator">|</span> <span class="token operator">#</span>data<span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span><br><span class="token operator">|</span> <span class="token operator">#</span>errors<span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Console</span><span class="token punctuation">.</span>error<span class="token punctuation">(</span>errors<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="handling-errors">Handling errors</h3>
<p>In either language, errors are represented the same. Here’s an example error
message:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"Render"</span><span class="token punctuation">,</span><br>  <span class="token property">"location"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"character"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"\"a\" is type null. I can only echo strings and numbers."</span><span class="token punctuation">,</span><br>  <span class="token property">"path"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token string">"ChildTemplate.acutis"</span><span class="token punctuation">,</span><br>    <span class="token string">"match"</span><span class="token punctuation">,</span><br>    <span class="token string">"MainTemplate.acutis"</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>Any of these fields may not be present if there isn’t any data for them. If
an exception was thrown while rendering, then it will be caught and added to
an <code>exn</code> field.</p>
<p>When Acutis encounters an error, it will try to keep processing the template
and report as many errors as it can find. But as long as there is at least
one error, then it won’t return any rendered data.</p>
<h2 id="template-functions-overview">Template functions overview</h2>
<p>Templates returned by <code>Compile.make</code> are functions that accept three
arguments:</p>
<ol>
<li>An environment object created by <code>Environment.make</code>.</li>
<li>A props object.</li>
<li>A children object.</li>
</ol>
<p>In ReScript, the environment is a <a href="https://rescript-lang.org/docs/manual/latest/record">record</a>, and props and children are both
<a href="https://rescript-lang.org/docs/manual/latest/api/js/dict">JS dictionary objects</a>.</p>
<p>The children argument is similar to the props, except it contains rendered
template sections. You’ll typically pass an empty object (<code>{}</code>) to this from
your top-level template. See <a href="#using-the-children-argument">using the <code>children</code> argument</a> for more
information about this.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="template-component-functions">Template component functions</h2>
<p>Because templates are just functions, we can write them manually with custom
JavaScript. Any functions we write will need to adhere to the same signature
as the functions created by <code>Compile.make</code>.</p>
<p>⚠️ In ReScript, template functions and their environment functions are
<a href="https://rescript-lang.org/docs/manual/latest/function#uncurried-function">uncurried</a>.</p>
<h3 id="compile.makeast"><code>Compile.makeAst</code></h3>
<p>The <code>Compile.makeAst</code> function is part of the low-level API that produces the
raw AST for a template. It accepts a string of the template contents, and its
output should be passed to <a href="#environment.render"><code>environment.render</code></a>.</p>
<p>Suppose we want a <code>Footer</code> template that will always display the current
year. We can write a template to similar to the following.</p>
<h4 id="javascript-example-2">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Compile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"acutis-lang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> ast <span class="token operator">=</span> Compile<span class="token punctuation">.</span><span class="token function">makeAst</span><span class="token punctuation">(</span><span class="token string">"Copyright {{ year }}"</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">function</span> <span class="token function">Footer</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span> year <span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="rescript-example-2">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token class-name">AcutisLang</span><span class="token punctuation">.</span><span class="token class-name">Compile</span><span class="token punctuation">.</span>makeAst<span class="token punctuation">(</span><span class="token string">"Copyright {{ year }}"</span><span class="token punctuation">,</span> __FILE__<span class="token punctuation">)</span><br><span class="token keyword">let</span> footer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>set<span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">,</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">.</span>getFullYear<span class="token punctuation">)</span><br>  env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">.</span> ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>⚠️ In ReScript, you may need to help the type inference by annotating your
functions like this:</p>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">open</span> <span class="token constructor variable">AcutisLang</span><br><span class="token keyword">let</span> footer<span class="token punctuation">:</span> <span class="token class-name">Acutis_Types</span><span class="token punctuation">.</span>template<span class="token operator">&lt;</span><span class="token operator">'</span>a<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>  env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">.</span> ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span></code></pre>
<h2 id="the-environment-functions">The environment functions</h2>
<p>The environment object (taken from the first argument) contains functions for
returning rendered template contents.</p>
<h3 id="environment.render"><code>environment.render</code></h3>
<p>The <code>render</code> function processes compiled template ASTs.</p>
<h4 id="javascript-example-3">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token comment">// Assume the AST is already defined</span><br><span class="token keyword">function</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="rescript-example-3">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token comment">// Assume the AST is already defined</span><br><span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>  env<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">.</span> ast<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span></code></pre>
<h3 id="environment.return"><code>environment.return</code></h3>
<p>The <code>return</code> function returns a string as-is, wrapped inside the result type.
This is useful if you don’t need the Acutis language features for a
component.</p>
<h4 id="javascript-example-4">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="rescript-example-4">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> sayHi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>  env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span></code></pre>
<h3 id="environment.error"><code>environment.error</code></h3>
<p>The <code>error</code> function returns an error with the given message. This will cause
the template to fail to render.</p>
<h4 id="javascript-example-5">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Fail."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="rescript-example-5">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> fail <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>  env<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">"Fail."</span><span class="token punctuation">)</span></code></pre>
<h3 id="environment.mapchild"><code>environment.mapChild</code></h3>
<p>The <code>mapChild</code> function takes a child prop and a callback to transform the
child’s contents. It returns a new child and does not mutate the original. If
the child has an error, then <code>mapChild</code> has no effect.</p>
<p>Template children are valid return types (each one is a fully rendered
template). So they can either be returned as your template or passed to the
children argument of <code>environment.render</code>.</p>
<h4 id="javascript-example-6">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">shout</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Children<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">mapChild</span><span class="token punctuation">(</span>Children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="rescript-example-6">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> shout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>  <span class="token keyword">switch</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token string">"Children"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token operator">|</span> <span class="token constructor variable">Some</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">=></span><br>    env<span class="token punctuation">.</span>mapChild<span class="token punctuation">(</span><span class="token punctuation">.</span> children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">String</span><span class="token punctuation">.</span>toUpperCase<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token operator">|</span> <span class="token constructor variable">None</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token string">""</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span></code></pre>
<h3 id="environment.flatmapchild"><code>environment.flatMapChild</code></h3>
<p>The <code>flatMapChild</code> function works similarly to <code>mapChild</code> except that it does
not automatically wrap the returned data. When using <code>flatMapChild</code>, you’re
responsible for wrapping the output with <code>environment.return</code> in your
callback. This means that you can choose to use <code>environment.error</code> instead
to represent failures.</p>
<h4 id="javascript-example-7">JavaScript example</h4>
<pre class="language-js"><code class="language-js"><span class="token comment">// assume we already defined a function called somethingThatThrows</span><br><span class="token keyword">function</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">flatMapChild</span><span class="token punctuation">(</span>Children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">contents</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token function">somethingThatThrows</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> env<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="rescript-example-7">ReScript example</h4>
<pre class="language-reason"><code class="language-reason"><span class="token comment">// assume we already defined a function called somethingThatThrows</span><br><span class="token keyword">let</span> shout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">.</span> env<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token operator">=></span><br>  env<span class="token punctuation">.</span>flatMapChild<span class="token punctuation">(</span><span class="token punctuation">.</span><br>    <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Dict</span><span class="token punctuation">.</span>unsafeGet<span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token string">"Children"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token punctuation">.</span> contents<span class="token punctuation">)</span> <span class="token operator">=></span><br>      <span class="token keyword">switch</span> somethingThatThrows<span class="token punctuation">(</span>contents<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token operator">|</span> result <span class="token operator">=></span> env<span class="token punctuation">.</span>return<span class="token punctuation">(</span><span class="token punctuation">.</span> result<span class="token punctuation">)</span><br>      <span class="token operator">|</span> <span class="token keyword">exception</span> <span class="token constructor variable">Failure</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=></span> env<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token punctuation">.</span> message<span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><br>  <span class="token punctuation">)</span></code></pre>
<h2 id="template-function-tips">Template function tips</h2>
<h3 id="synchronous-and-asynchronous-templates">Synchronous and asynchronous templates</h3>
<p>If you have a template function that uses <code>async</code> functions or promises, then
you need to render your whole template tree with an asynchronous environment.</p>
<p>Templates components inherit their environment from their parent templates,
so synchronous templates can be used interchangeably between environment
types. This does not work the other way around, though. Asynchronous
templates cannot be made synchronous.</p>
<h3 id="using-the-children-argument">Using the children argument</h3>
<p><a href="../manual/#template-children-props">Template components can accept template sections as children props</a>, but
these are not interchangeable with pattern props. Therefore, Acutis keeps
rendered template children in a separate object.</p>
<p>You will usually not need to directly manipulate the children argument, or
often you can just pass an empty object (<code>{}</code>) as children.</p>
<p>If you are manually rendering a template section within a function, then make
sure you pass it to the children argument.</p>
<h2 id="node-helpers-api">Node helpers API</h2>
<p>Acutis includes functions for rendering templates in a Node.js environment,
such as for a static site generator. They can be imported from module
<code>acutis-lang/node-utils</code>.</p>
<h3 id="loadtemplate"><code>loadTemplate</code></h3>
<p>Calling <code>loadTemplate(fileName)</code> will return a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> of a template
function.</p>
<ul>
<li>If the filename ends with a <code>.js</code> extension, then it will load it with
<code>require</code>.</li>
<li>If the filename ends with a <code>.mjs</code> extension, then it will load it
with dynamic <code>import</code>.</li>
</ul>
<p>For both of those cases, it uses the “default” export as the template
function.</p>
<p>For all other file extension, it loads the file’s text content as the
template.</p>
<h3 id="filenametocomponent"><code>filenameToComponent</code></h3>
<p>Calling <code>filenameToComponent(fileName)</code> strips the extension and capitalizes
the first letter. Example: <code>filenameToComponent(&quot;footer.js&quot;)</code> returns
<code>&quot;Footer&quot;</code>. This is just a convenience to help components adhere to template
naming rules.</p>
<h2 id="acutis-command-line-interface-(cli)">Acutis command line interface (CLI)</h2>
<p>You can use Acutis from the command line. It accepts JSON data and an array
of template filenames, and it prints the rendered output.</p>
<pre class="language-shell"><code class="language-shell">acutis Index.acutis src/**/*.<span class="token punctuation">(</span>js<span class="token operator">|</span>mjs<span class="token operator">|</span>acutis<span class="token punctuation">)</span> <span class="token operator">&lt;</span> data.json <span class="token operator">></span> dist/index.html</code></pre>
<p>Full options:</p>
<pre class="language-html"><code class="language-html">Usage:<br>  acutis [options] [template] [templates...]<br><br>Options:<br>  -a, --async                   Enable asynchronous templates. Default: false.<br>  -d, --data                    The path to the JSON data file. Default: stdin.<br>  -o, --output                  The path to write the output. Default: stdout.<br>  -t, --table                   Print errors in a table. Default: false.<br>  -h, --help                    Show this message and exit.<br>  -v, --version                 Show the version and exit.<br><br>Templates:<br>  The first template listed is the root template. Templates with .js or .mjs<br>  extensions are rendered using their default export function. For all other<br>  file types, their text content is used as the template.<br><br>Examples:<br>  acutis --data=data.json --output=index.html Index.acutis Header.js Footer.acutis<br>  acutis Index.acutis _includes/**/*.(js|mjs|acutis) &lt; data.json > index.html<br>  curl https://example.com/api | acutis Index.acutis *.(js|acutis) -o index.html </code></pre>

      </article>
    </main><footer class="footer">
  <p>
    Published in 2021 by <a href="https:&#x2F;&#x2F;johnridesa.bike">John Jackson</a>.
  </p>
  <p class="footer__license">
    <a href="https:&#x2F;&#x2F;johnridesa.bike&#x2F;acutis/license/">View the license</a>.
  </p>
</footer>
</body>
</html>