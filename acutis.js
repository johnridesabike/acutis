/**!
 *    Copyright 2021 John Jackson
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */
function r(r){return void 0===r?{BS_PRIVATE_NESTED_SOME_NONE:0}:null!==r&&void 0!==r.BS_PRIVATE_NESTED_SOME_NONE?{BS_PRIVATE_NESTED_SOME_NONE:r.BS_PRIVATE_NESTED_SOME_NONE+1|0}:r}function n(r){if(null===r||void 0===r.BS_PRIVATE_NESTED_SOME_NONE)return r;var n=r.BS_PRIVATE_NESTED_SOME_NONE;return 0===n?void 0:{BS_PRIVATE_NESTED_SOME_NONE:n-1|0}}function t(n,t){if(t>=0&&t<n.length)return r(n[t])}function e(r,n){for(var t=0,e=r.length;t<e;++t)n(r[t])}function a(r,n){for(var t=r.length,e=new Array(t),a=0;a<t;++a)e[a]=n(r[a]);return e}var o={contents:0};function i(r){return o.contents=o.contents+1|0,r+"/"+o.contents}var u={map:function(r,n){return{_0:n(r._0),_1:a(r._1,n)}}};var c={$$location:function(r){return{character:r+1|0}},Stack:{nameToJson:function(r){if("number"==typeof r)return 0===r?"match":"map";switch(0|r.TAG){case 0:var n=r._0;return void 0!==n?n:null;case 1:return"section: "+r.component+"#"+r.section;case 2:return r._0}}}};var s={toString:function(r){switch(0|r.TAG){case 0:return"[text]: "+r._1;case 1:return"{*"+r._1+"*}";case 2:return'"'+r._1+'"';case 3:return String(r._1);case 4:return"true";case 5:return"false";case 6:return"null";case 7:return",";case 8:return":";case 9:return"[";case 10:return"]";case 11:return"{";case 12:return"}";case 13:return"...";case 15:return"/";case 16:return"#";case 17:return"=";case 14:case 18:return r._1;case 19:return"~";case 20:return"?";case 21:return"&";case 22:return"{{";case 23:return"[end of file]"}},toLocation:function(r){return r._0}};var f={make:function(r){return{data:r,acutis_is_valid:"ACUTIS_IS_VALID"}},validate:function(n){if("ACUTIS_IS_VALID"===n.acutis_is_valid)return r(n.data)}};var _={toString:function(r){switch(0|r.TAG){case 0:return"null";case 1:case 2:return"boolean";case 3:return"string";case 4:return"number";case 5:case 6:return"array";case 7:return"object";case 8:return"binding: `"+r._1+"`"}},toLocation:function(r){return 6===r.TAG?r.loc:r._0}};function v(r){return a(function(r){var n=function(r){for(var n=r,t=0;;){if(!n)return t;t=t+1|0,n=n.tl}}(r),t=new Array(n);return function(r,n,t){for(;;){var e=t,a=n;if(!e)return;r[a]=e.hd,t=e.tl,n=a+1|0}}(t,0,r),t}(r),c.Stack.nameToJson)}var A=i("Debug-AcutisLang.CompileError");function l(r,n){throw{RE_EXN_ID:A,_1:{message:"Unexpected end of file.",kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function d(r,n){throw{RE_EXN_ID:A,_1:{message:"Unterminated comment.",kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function T(r,n){throw{RE_EXN_ID:A,_1:{message:"Unterminated string.",kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function G(r,n,t){throw{RE_EXN_ID:A,_1:{message:'Invalid character: "'+t+'".',kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function h(r,n,t,e){throw{RE_EXN_ID:A,_1:{message:'Unexpected character: "'+t+'". Expected: "'+e+'".',kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function p(r,n){throw{RE_EXN_ID:A,_1:{message:'Unexpected token: "'+s.toString(r)+'".',kind:"Parse",location:c.$$location(s.toLocation(r)),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function m(r){if("number"==typeof r)switch(r){case 0:case 1:return"boolean";case 2:return"null"}else switch(0|r.TAG){case 0:return"string";case 1:return"number";case 2:return"object";case 3:return"array"}}function E(r,n,t){return{message:'Component "'+n+'" does not exist.',kind:"Render",location:c.$$location(r),path:v(t),exn:void 0}}function g(r,n,t){var e=m(r);return{message:"This pattern is type "+_.toString(n)+" but the data is type "+e+".",kind:"Type",location:c.$$location(_.toLocation(n)),path:v(t),exn:void 0}}function k(r,n,t){return{message:'"'+n+'" is bound multiple times in this pattern.',kind:"Pattern",location:c.$$location(r),path:v(t),exn:void 0}}function b(r,n){return{message:"None of the patterns match the data. Consider a catch-all case to avoid this.",kind:"Pattern",location:c.$$location(r),path:v(n),exn:void 0}}function w(r,n){return{message:"The number of patterns does not match the number of data.",kind:"Pattern",location:c.$$location(r),path:v(n),exn:void 0}}function N(r,n,t,e){return{message:'"'+n+'" is type '+m(t)+". I can only echo strings and numbers.",kind:"Render",location:c.$$location(r),path:v(e),exn:void 0}}function y(r,n,t){return{message:'Template child "'+n+'" does not exist.',kind:"Render",location:c.$$location(r),path:v(t),exn:void 0}}function x(r,n,t,e){return{message:'"'+n+'" is a '+m(t)+". I can only map arrays.",kind:"Type",location:c.$$location(r),path:v(e),exn:void 0}}function L(r){return{message:"A template AST was not valid. Did you forget to compile one?",kind:"Render",location:void 0,path:v(r),exn:void 0}}function S(n,t){return{message:"An exception was thrown while rendering this template. This is probably due to malformed input.",kind:"Compile",location:void 0,path:[void 0!==t?t:null],exn:r(n)}}function V(n,t){return{message:"An exception was thrown while rendering a template component.",kind:"Render",location:void 0,path:v(t),exn:r(n)}}function $(r,n){return{message:r,kind:"Render",location:void 0,path:v(n),exn:void 0}}function M(r){r.length=0,r.first=void 0,r.last=void 0}function I(r,n){var t={content:n,next:void 0},e=r.last;void 0!==e?(r.length=r.length+1|0,e.next=t,r.last=t):(r.length=1,r.first=t,r.last=t)}function R(r){return 0===r.length}function D(r,n){for(var t=r.first;;){var e=t;if(void 0===e)return;n(e.content),t=e.next}}function P(r,n){if(!(r.length<=0)){var t=n.last;return void 0!==t?(n.length=n.length+r.length|0,t.next=r.first,n.last=r.last,M(r)):(n.length=r.length,n.first=r.first,n.last=r.last,M(r))}}function O(r){var n=new Array(r.length);return function(r,n,t){for(;;){var e=t,a=r;if(void 0===e)return;n[a]=e.content,t=e.next,r=a+1|0}}(0,n,r.first),n}function C(r,n){return r.str.charAt(r.position+n|0)}function X(r){return r.str.charAt(r.position)}function B(r){r.position=r.position+1|0}function j(r){var n=X(r);return B(r),n}function U(r,n){r.position=r.position+n|0}function z(r,n){var t=r.position,e=function(r,n){for(var t=r.position;!n(r.str.charAt(t));)t=t+1|0;return t}(r,n);return r.position=e,r.str.slice(t,e)}function F(r,n){var t=r.position;return r.position=r.position+n|0,r.str.slice(t,r.position)}function J(r){switch(r){case"+":case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"e":return!1;default:return!0}}function Z(r,n){for(var t=r.position,e=0;;){var a=e;switch(C(r,a)){case"":return I(n,{TAG:0,_0:t,_1:F(r,a)}),3;case"{":switch(C(r,a+1|0)){case"%":return I(n,{TAG:0,_0:t,_1:F(r,a)}),U(r,2),1;case"*":return I(n,{TAG:0,_0:t,_1:F(r,a)}),U(r,2),2;case"{":return I(n,{TAG:0,_0:t,_1:F(r,a)}),U(r,2),0;default:e=a+2|0;continue}default:e=a+1|0;continue}}}function q(r,n){for(var t=r.position,e=0,a=0;;){var o=a,i=e;switch(C(r,i)){case"":return d(t,n);case"*":if("}"===C(r,i+1|0)){if(0===o){var u=F(r,i);return U(r,2),u}a=o-1|0,e=i+2|0;continue}e=i+2|0;continue;case"{":if("*"===C(r,i+1|0)){a=o+1|0,e=i+2|0;continue}e=i+1|0;continue;default:e=i+1|0;continue}}}var H=/\\"/g;function K(r,n){for(var t=r.position,e=0;;){var a=e;switch(C(r,a)){case"":return T(t,n);case'"':var o=F(r,a).replace(H,'"');return B(r),o;case"\\":switch(C(r,a+1|0)){case'"':case"\\":e=a+2|0;continue;default:e=a+1|0;continue}default:e=a+1|0;continue}}}function Q(r,n){var t,e=r.position,a=z(r,J),o=(t=parseFloat(a),isNaN(t)?void 0:t);return void 0!==o?o:function(r,n,t){throw{RE_EXN_ID:A,_1:{message:'"'+t+'" is an illegal identifier name.',kind:"Parse",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}(e,n,a)}var W=/^[a-zA-Z0-9_]$/;function Y(r){return!W.test(r)}var rr=/^[a-z_]$/,nr=/^[A-Z]$/;function tr(r,n){var t=z(r,Y);switch(t){case"false":return{TAG:5,_0:n};case"null":return{TAG:6,_0:n};case"true":return{TAG:4,_0:n};default:return{TAG:18,_0:n,_1:t}}}function er(r,n,t,e){for(var a=!0;a;){var o=r.position,i=X(r),u=0;if(i===e)B(r),a=!1;else switch(i){case"":l(o,t);break;case"\t":case"\n":case"\r":case" ":B(r);break;case'"':B(r),I(n,{TAG:2,_0:o,_1:K(r,t)});break;case"#":B(r),I(n,{TAG:16,_0:o});break;case"&":B(r),I(n,{TAG:21,_0:o});break;case",":B(r),I(n,{TAG:7,_0:o});break;case".":var c=F(r,3);"..."===c?I(n,{TAG:13,_0:o}):h(o,t,c,"...");break;case"/":B(r),I(n,{TAG:15,_0:o});break;case"-":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":u=1;break;case":":B(r),I(n,{TAG:8,_0:o});break;case"=":B(r),I(n,{TAG:17,_0:o});break;case"?":B(r),I(n,{TAG:20,_0:o});break;case"[":B(r),I(n,{TAG:9,_0:o});break;case"]":B(r),I(n,{TAG:10,_0:o});break;case"{":B(r),I(n,{TAG:11,_0:o});break;case"}":B(r),I(n,{TAG:12,_0:o});break;case"~":B(r),I(n,{TAG:19,_0:o});break;default:rr.test(i)?I(n,tr(r,o)):nr.test(i)?I(n,{TAG:14,_0:o,_1:z(r,Y)}):G(o,t,i)}1===u&&I(n,{TAG:3,_0:o,_1:Q(r,t)})}}function ar(r){return function(r){var n=r.first;if(void 0!==n)return n.content;throw{RE_EXN_ID:"Not_found",Error:new Error}}(r.tokens)}function or(r){return function(r){var n=r.first;if(void 0!==n){var t=n.next;return void 0===t?(M(r),n.content):(r.length=r.length-1|0,r.first=t,n.content)}throw{RE_EXN_ID:"Not_found",Error:new Error}}(r.tokens)}function ir(r){return r.name}var ur=i("Caml_js_exceptions.Error");function cr(r){return function(r){return null!=r&&"string"==typeof r.RE_EXN_ID}(r)?r:{RE_EXN_ID:ur,_1:r}}function sr(r,n){switch(0|r.TAG){case 2:return{TAG:3,_0:r._0,_1:r._1};case 3:return{TAG:4,_0:r._0,_1:r._1};case 4:return{TAG:2,_0:r._0};case 5:return{TAG:1,_0:r._0};case 6:return{TAG:0,_0:r._0};case 9:var t=r._0,e=or(n);if(10===e.TAG)return{TAG:5,_0:t,_1:[]};var a={length:0,first:void 0,last:void 0};for(I(a,sr(e,n));;){var o=or(n);switch(0|o.TAG){case 7:var i=or(n);if(13===i.TAG){var u=or(n);if(18!==u.TAG)return p(u,ir(n));var c=or(n);return 10===c.TAG?{TAG:6,loc:t,array:O(a),bindLoc:u._0,binding:u._1}:p(c,ir(n))}I(a,sr(i,n));continue;case 10:return{TAG:5,_0:t,_1:O(a)};default:return p(o,ir(n))}}case 11:var s=r._0,f=or(n);if(12===f.TAG)return{TAG:7,_0:s,_1:[]};var _={length:0,first:void 0,last:void 0};for(I(_,fr(f,n));;){var v=or(n);switch(0|v.TAG){case 7:I(_,fr(or(n),n));continue;case 12:return{TAG:7,_0:s,_1:O(_)};default:return p(v,ir(n))}}case 18:return{TAG:8,_0:r._0,_1:r._1};default:return p(r,ir(n))}}function fr(r,n){switch(0|r.TAG){case 2:var t=or(n);return 8===t.TAG?[r._1,sr(or(n),n)]:p(t,ir(n));case 18:var e=r._1;return 8!==ar(n).TAG?[e,{TAG:8,_0:r._0,_1:e}]:(or(n),[e,sr(or(n),n)]);default:return p(r,ir(n))}}function _r(r){for(var n=sr(or(r),r),t={length:0,first:void 0,last:void 0};;){if(7!==ar(r).TAG)return{_0:n,_1:O(t)};or(r),I(t,sr(or(r),r))}}function vr(r){var n=or(r);return 18===n.TAG?[n._0,n._1]:p(n,ir(r))}function Ar(r){for(var n=vr(r),t={length:0,first:void 0,last:void 0};;){if(7!==ar(r).TAG)return{_0:n,_1:O(t)};or(r),I(t,vr(r))}}function lr(r,n,t){switch(0|r.TAG){case 2:return{TAG:2,_0:r._1,_1:t};case 3:return{TAG:3,_0:r._1,_1:t};case 18:return{TAG:0,_0:r._0,_1:r._1,_2:t};default:return p(r,ir(n))}}function dr(r){var n=or(r);switch(0|n.TAG){case 14:return{TAG:1,_0:n._0,_1:n._1};case 21:return lr(or(r),r,0);default:return lr(n,r,1)}}function Tr(r){for(var n=dr(r),t={length:0,first:void 0,last:void 0};;){var e=or(r);switch(0|e.TAG){case 0:case 19:return[e,{_0:n,_1:O(t)}];case 20:I(t,dr(r));continue;default:return p(e,ir(r))}}}function Gr(r){switch(0|r.TAG){case 15:return!0;case 18:return"with"===r._1;default:return!1}}function hr(r){return 23===r.TAG}function pr(r){return 15===r.TAG}function mr(r,n,t){for(var e={length:0,first:void 0,last:void 0},a=r;;){var o=a;if(t(o))return[o,O(e)];switch(0|o.TAG){case 0:var i=o._1,u=or(n);if(19===u.TAG){I(e,{TAG:0,_0:i,_1:1}),a=or(n);continue}I(e,{TAG:0,_0:i,_1:3}),a=u;continue;case 1:a=or(n);continue;case 14:I(e,kr(o._0,o._1,n)),a=or(n);continue;case 18:switch(o._1){case"map":var c=vr(n),s=gr(n,"map");I(e,{TAG:3,_0:c[0],_1:c[1],_2:s}),a=or(n);continue;case"match":var f=Ar(n),_=gr(n,"match");I(e,{TAG:2,_0:o._0,_1:f,_2:_}),a=or(n);continue;default:return p(o,ir(n))}case 19:var v=or(n);if(0!==v.TAG)return p(v,ir(n));var A=v._1,l=or(n);if(19===l.TAG){I(e,{TAG:0,_0:A,_1:2}),a=or(n);continue}I(e,{TAG:0,_0:A,_1:0}),a=l;continue;case 22:var d=Tr(n);I(e,{TAG:1,_0:o._0,_1:d[1]}),a=d[0];continue;default:return p(o,ir(n))}}}function Er(r){for(var n=_r(r),t={length:0,first:void 0,last:void 0};;){var e=or(r);if(18!==e.TAG||"with"!==e._1){var a=mr(e,r,Gr);return[a[0],{patterns:{_0:n,_1:O(t)},ast:a[1]}]}I(t,_r(r))}}function gr(r,n){var t=or(r);if(18!==t.TAG)return p(t,ir(r));if("with"!==t._1)return p(t,ir(r));for(var e=Er(r),a=e[1],o={length:0,first:void 0,last:void 0},i=e[0];;){if(15===i.TAG){var u=or(r);return 18===u.TAG&&u._1===n?{_0:a,_1:O(o)}:p(u,ir(r))}var c=Er(r);I(o,c[1]),i=c[0]}}function kr(r,n,t){var e=function(r){var n={length:0,first:void 0,last:void 0},t={length:0,first:void 0,last:void 0},e=or(r);for(;;){var a=e;switch(0|a.TAG){case 14:var o=a._1,i=or(r);if(17!==i.TAG){I(t,[o,{TAG:0,_0:o}]),e=i;continue}var u=or(r);switch(0|u.TAG){case 14:I(t,[o,{TAG:0,_0:u._1}]),e=or(r);continue;case 16:var c=mr(or(r),r,pr),s=or(r);if(16!==s.TAG)return p(s,ir(r));I(t,[o,{TAG:1,_0:c[1]}]),e=or(r);continue;default:return p(u,ir(r))}case 18:var f=a._1,_=or(r);if(17===_.TAG){I(n,[f,sr(or(r),r)]),e=or(r);continue}I(n,[f,{TAG:8,_0:a._0,_1:f}]),e=_;continue;default:return[a,n,t]}}}(t),a=e[2],o=e[1],i=e[0];if(15===i.TAG)return{TAG:4,loc:r,name:n,props:O(o),children:O(a)};var u=mr(i,t,pr),c=or(t);return 14===c.TAG&&n===c._1?(I(a,["Children",{TAG:1,_0:u[1]}]),{TAG:4,loc:r,name:n,props:O(o),children:O(a)}):p(c,ir(t))}function br(r,n){try{var t=function(r,n){for(var t={str:n,position:0},e={length:0,first:void 0,last:void 0},a=Z(t,e);;)switch(a){case 0:var o=t.position;"~"===X(t)&&(I(e,{TAG:19,_0:t.position}),B(t)),I(e,{TAG:22,_0:o}),er(t,e,r,"}");var i=j(t);if("}"!==i)return h(t.position,r,i,"}");a=Z(t,e);continue;case 1:er(t,e,r,"%");var u=j(t);if("}"!==u)return h(t.position,r,u,"}");a=Z(t,e);continue;case 2:I(e,{TAG:1,_0:t.position,_1:q(t,r)}),a=Z(t,e);continue;case 3:return I(e,{TAG:23,_0:t.position}),{tokens:e,name:r}}}(r,n),e=mr(or(t),t,hr);return f.make({NAME:"data",VAL:{ast:e[1],name:r}})}catch(n){var a=cr(n);return a.RE_EXN_ID===A?f.make({NAME:"errors",VAL:a._1}):f.make({NAME:"errors",VAL:S(a,r)})}}function wr(n,t){if(t in n)return r(n[t])}function Nr(r){var n=typeof r;return"string"===n?{TAG:0,_0:r}:"number"===n?{TAG:1,_0:r}:"boolean"===n?!0===r?1:0:null===r?2:Array.isArray(r)?{TAG:3,_0:r}:{TAG:2,_0:r}}function yr(r,n){return 0===r.TAG?{TAG:0,_0:n(r._0)}:{TAG:1,_0:r._0}}function xr(r){return void 0!==r?r.h:0}function Lr(r,n,t,e){var a=xr(r),o=xr(e);return{k:n,v:t,h:a>=o?a+1|0:o+1|0,l:r,r:e}}function Sr(r,n,t,e){var a=void 0!==r?r.h:0,o=void 0!==e?e.h:0;if(a>(o+2|0)){var i=r.l,u=r.r;return xr(i)>=xr(u)?Lr(i,r.k,r.v,Lr(u,n,t,e)):Lr(Lr(i,r.k,r.v,u.l),u.k,u.v,Lr(u.r,n,t,e))}if(o<=(a+2|0))return{k:n,v:t,h:a>=o?a+1|0:o+1|0,l:r,r:e};var c=e.l,s=e.r;return xr(s)>=xr(c)?Lr(Lr(r,n,t,c),e.k,e.v,s):Lr(Lr(r,n,t,c.l),c.k,c.v,Lr(c.r,e.k,e.v,s))}function Vr(r,n,t){if(void 0===r)return{k:n,v:t,h:1,l:void 0,r:void 0};var e,a,o=r.k;if(n===o)return a=t,(e=r).v===a?e:{k:e.k,v:a,h:e.h,l:e.l,r:e.r};var i=r.v;return n<o?Sr(Vr(r.l,n,t),o,i,r.r):Sr(r.l,o,i,Vr(r.r,n,t))}var $r=function(r,n){for(;;){var t=r;if(void 0===t)return!1;var e=t.k;if(n===e)return!0;r=n<e?t.l:t.r}},Mr=function r(n,t){for(;;){var e=n;if(void 0===e)return;r(e.l,t),t(e.k,e.v),n=e.r}};function Ir(r,e){for(var a={length:0,first:void 0,last:void 0},o=0;;){var i=o,u=t(r,i);if(void 0===u)return{TAG:0,_0:a};var c=e(n(u));if(0!==c.TAG)return c;I(a,c._0),o=i+1|0}}function Rr(r,t){switch(0|r.TAG){case 0:return{TAG:0,_0:null};case 1:return{TAG:0,_0:!1};case 2:return{TAG:0,_0:!0};case 3:case 4:return{TAG:0,_0:r._1};case 5:return yr(Ir(r._1,(function(r){return Rr(r,t)})),O);case 6:var e=r.binding,a=wr(t,e);if(void 0===a)return{TAG:1,_0:{TAG:1,loc:r.bindLoc,binding:e}};var o=Nr(n(a));if("number"==typeof o)return{TAG:1,_0:{TAG:0,data:o,pattern:r,binding:e}};if(3!==o.TAG)return{TAG:1,_0:{TAG:0,data:o,pattern:r,binding:e}};var i=o._0;return yr(Ir(r.array,(function(r){return Rr(r,t)})),(function(r){return function(r,n){for(var t=r.length,e=n.length,a=new Array(t+e|0),o=0;o<t;++o)a[o]=r[o];for(var i=0;i<e;++i)a[t+i|0]=n[i];return a}(O(r),i)}));case 7:return yr(Ir(r._1,(function(r){var n=r[0];return yr(Rr(r[1],t),(function(r){return[n,r]}))})),(function(r){var n={};return D(r,(function(r){n[r[0]]=r[1]})),n}));case 8:var u=r._1,c=wr(t,u);return void 0!==c?{TAG:0,_0:n(c)}:{TAG:1,_0:{TAG:1,loc:r._0,binding:u}}}}function Dr(r,n,t,e){return"_"===n?{TAG:0,_0:r}:$r(r,n)?{TAG:1,_0:{TAG:1,loc:e,binding:n}}:{TAG:0,_0:Vr(r,n,t)}}function Pr(r,e,a){var o,i,u=Nr(e);switch(0|r.TAG){case 0:return"number"==typeof u&&u>=2?{TAG:0,_0:a}:{TAG:1,_0:0};case 1:if("number"!=typeof u)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};switch(u){case 0:return{TAG:0,_0:a};case 1:case 2:return{TAG:1,_0:0}}case 2:if("number"!=typeof u)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};switch(u){case 1:return{TAG:0,_0:a};case 0:case 2:return{TAG:1,_0:0}}case 3:return"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:0===u.TAG?r._1===u._0?{TAG:0,_0:a}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};case 4:return"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:1===u.TAG?r._1===u._0?{TAG:0,_0:a}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};case 5:var c=r._1;return 0!==c.length?"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:3===u.TAG?Or(c,u._0,a):{TAG:1,_0:{TAG:0,data:u,pattern:r}}:"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:3===u.TAG?0!==u._0.length?{TAG:1,_0:0}:{TAG:0,_0:a}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};case 6:var s=r.binding,f=r.bindLoc,_=r.array;if("number"==typeof u)return 2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if(3!==u.TAG)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};var v=u._0;return o=Or(_,v,a),i=function(r){return Dr(r,s,function(r,n){for(var t,e,a=r.length,o=n<0?(t=a+n|0)>(e=0)?t:e:n,i=a-o|0,u=new Array(i),c=0;c<i;++c)u[c]=r[o+c|0];return u}(v,_.length),f)},0===o.TAG?i(o._0):{TAG:1,_0:o._0};case 7:var A=r._1;if(0===A.length)return"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:2===u.TAG?0===Object.keys(u._0).length?{TAG:0,_0:a}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if("number"==typeof u)return 2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if(2!==u.TAG)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};for(var l=u._0,d=a,T=0;;){var G=T,h=d,p=t(A,G);if(void 0===p)return{TAG:0,_0:h};var m=wr(l,p[0]);if(void 0===m)return{TAG:1,_0:0};var E=Pr(p[1],n(m),h);if(0!==E.TAG)return E;T=G+1|0,d=E._0}case 8:return Dr(a,r._1,e,r._0)}}function Or(r,e,a){for(var o=a,i=0;;){var u=i,c=o,s=t(r,u);if(void 0===s)return{TAG:0,_0:c};var f=t(e,u);if(void 0===f)return{TAG:1,_0:0};var _=Pr(s,n(f),c);if(0!==_.TAG)return _;i=u+1|0,o=_._0}}function Cr(r,e){for(var a,o=e._1,i=r._1,u=r._0,c=e._0,s=0;;){var f=s,_=Pr(u,c,a);if(0!==_.TAG)return _;var v=_._0,A=t(i,f),l=t(o,f);if(void 0===A){if(void 0!==l)return{TAG:1,_0:1};var d={};return Mr(v,function(r){return function(n,t){r[n]=t}}(d)),{TAG:0,_0:d}}if(void 0===l)return{TAG:1,_0:1};s=f+1|0,a=v,c=n(l),u=A}}function Xr(r,n){for(var e=r.f,a=r.patterns,o=a._1,i=a._0,u=0;;){var c=u,s=Cr(i,n);if(0===s.TAG)return{TAG:0,_0:e(s._0)};var f=s._0;if("number"!=typeof f)return s;if(0!==f)return s;var _=t(o,c);if(void 0===_)return{TAG:1,_0:0};u=c+1|0,i=_}}function Br(r){switch(r){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&apos;";case"/":return"&#x2F;";case"<":return"&lt;";case"=":return"&#x3D;";case">":return"&gt;";case"`":return"&#x60;";default:return r}}function jr(r,n){if(!r)return n;for(var t=0,e="";;){var a=e,o=t,i=n.charAt(o);if(""===i)return a;e=a+Br(i),t=o+1|0}}function Ur(r,t){var e=wr(r,t);return void 0!==e?n(e):null}function zr(r,n){var t=Nr(Ur(r,n));if("number"==typeof t)return{TAG:1,_0:t};switch(0|t.TAG){case 0:return{TAG:0,_0:t._0};case 1:return{TAG:0,_0:String(t._0)};default:return{TAG:1,_0:t}}}function Fr(r){return function(n){return 0!==n._1.length?n:{_0:n._0,_1:[{TAG:8,_0:r,_1:"_"}]}}}function Jr(r,n,e,a){var o=function(r,n){for(var e=r._1,a=r._0,o=0;;){var i=o,u=Xr(a,n);if(0===u.TAG)return u;var c=u._0;if("number"!=typeof c)return u;if(0!==c)return u;var s=t(e,i);if(void 0===s)return{TAG:1,_0:0};o=i+1|0,a=s}}(r,n);if(0===o.TAG)return o;var i=o._0;return"number"==typeof i?0===i?{TAG:1,_0:b(e,a)}:{TAG:1,_0:w(e,a)}:0===i.TAG?{TAG:1,_0:g(i.data,i.pattern,a)}:{TAG:1,_0:k(i.loc,i.binding,a)}}function Zr(r){for(var n=0;;){var t=n;switch(r.charAt(t)){case"\t":case"\n":case"\r":case" ":n=t+1|0;continue;default:return r.slice(t)}}}function qr(r){for(var n=r.length;;){var t=n;switch(r.charAt(t-1|0)){case"\t":case"\n":case"\r":case" ":n=t-1|0;continue;default:return r.slice(0,t)}}}function Hr(r,a,o,i,s,f,A,l){var d=i.stack,T=i.components,G=s(i),h={length:0,first:void 0,last:void 0};return e(r,(function(r){switch(0|r.TAG){case 0:var p,g=r._0;switch(r._1){case 0:p=Zr(g);break;case 1:p=qr(g);break;case 2:p=Zr(qr(g));break;case 3:p=g}return I(h,G.return(p));case 1:var k=r._1;return I(h,function(r,e,a,o,i,u,c){for(var s=r,f=0;;){var _=f,v=s;switch(0|v.TAG){case 0:var A=v._1,l=zr(a,A);if(0===l.TAG)return u.return(jr(v._2,l._0));var d=l._0,T=t(e,_);if("number"==typeof d&&d>=2&&void 0!==T){f=_+1|0,s=T;continue}return c([N(v._0,A,d,o)]);case 1:var G=v._1,h=wr(i,G);if(void 0!==h)return n(h);var p=t(e,_);if(void 0===p)return c([y(v._0,G,o)]);f=_+1|0,s=p;continue;case 2:return u.return(jr(v._1,v._0));case 3:return u.return(jr(v._1,String(v._0)))}}}(k._0,k._1,a,d,o,G,f));case 2:var b=Jr(u.map(r._2,(function(r){var n=r.ast;return{patterns:r.patterns,f:function(r){return Hr(n,Object.assign({},a,r),o,{components:i.components,stack:{hd:0,tl:d}},s,f,A,l)}}})),u.map(r._1,(function(r){return Ur(a,r[1])})),r._0,d);return 0===b.TAG?P(b._0,h):I(h,f([b._0]));case 3:var w=r._2,L=r._1,S=r._0,$=Nr(Ur(a,L));return"number"!=typeof $&&3===$.TAG?function(r,n){for(var t=0,e=r.length;t<e;++t)n(t,r[t])}($._0,(function(r,n){var t=Jr(u.map(w,(function(n){var t=n.ast;return{patterns:u.map(n.patterns,Fr(S)),f:function(n){return Hr(t,Object.assign({},a,n),o,{components:i.components,stack:{hd:{TAG:2,_0:r},tl:{hd:1,tl:d}}},s,f,A,l)}}})),{_0:n,_1:[r]},S,d);return 0===t.TAG?P(t._0,h):I(h,f([t._0]))})):I(h,f([x(S,L,$,d)]));case 4:var M=r.name,D=r.loc,C=wr(T,M);if(void 0===C)return I(h,f([E(D,M,d)]));var X={},B={},j={length:0,first:void 0,last:void 0};return e(r.children,(function(r){var t=r[1],e=r[0];if(0===t.TAG){var u=t._0,c=wr(o,u);return void 0!==c?void(B[e]=n(c)):I(j,y(D,u,d))}B[e]=l(Hr(t._0,a,o,{components:i.components,stack:{hd:{TAG:1,component:M,section:e},tl:d}},s,f,A,l))})),e(r.props,(function(r){var n=Rr(r[1],a);if(0!==n.TAG){var t=n._0;return 0===t.TAG?I(j,function(r,n,t,e){var a=m(r);return{message:'"'+t+'" is type '+_.toString(n)+" but the data is type "+a+".",kind:"Type",location:c.$$location(_.toLocation(n)),path:v(e),exn:void 0}}(t.data,t.pattern,t.binding,d)):I(j,function(r,n,t){return{message:'Binding "'+n+'" does not exist.',kind:"Render",location:c.$$location(r),path:v(t),exn:void 0}}(t.loc,t.binding,d))}X[r[0]]=n._0})),R(j)?I(h,A((function(){return C(G,X,B)}),(function(r){return f([V(r,d)])}))):I(h,f(O(j)))}})),h}function Kr(r){return Promise.resolve({NAME:"data",VAL:r})}function Qr(r){return Promise.resolve({NAME:"errors",VAL:r})}function Wr(r,n){return r().catch((function(r){return n(r)}))}function Yr(r,n){return r.then((function(r){return"errors"===r.NAME?Promise.resolve(r):Promise.resolve({NAME:"data",VAL:n(r.VAL)})}))}function rn(r,n){return r.then((function(r){return"errors"===r.NAME?Promise.resolve(r):n(r.VAL)}))}function nn(r){var n={contents:""},t={length:0,first:void 0,last:void 0};return e(r,(function(r){return"errors"===r.NAME?e(r.VAL,(function(r){return I(t,r)})):void(n.contents=n.contents+r.VAL)})),R(t)?Promise.resolve({NAME:"data",VAL:n.contents}):Promise.resolve({NAME:"errors",VAL:O(t)})}function tn(r){return Promise.all(O(r)).then(nn)}function en(r){var n=r.stack,t=r.components;return{render:function(r,e,a){var o=f.validate(r);if(void 0===o)return Promise.resolve({NAME:"errors",VAL:[L(n)]});if("errors"===o.NAME)return Promise.resolve({NAME:"errors",VAL:[o.VAL]});var i=o.VAL;return tn(Hr(i.ast,e,a,{components:t,stack:{hd:{TAG:0,_0:i.name},tl:n}},en,Qr,Wr,tn))},return:Kr,error:function(r){return Promise.resolve({NAME:"errors",VAL:[$(r,n)]})},mapChild:Yr,flatMapChild:rn}}function an(r){return{NAME:"data",VAL:r}}function on(r){return{NAME:"errors",VAL:r}}function un(r,n){try{return r()}catch(r){return n(cr(r))}}function cn(r,n){return"errors"===r.NAME?r:{NAME:"data",VAL:n(r.VAL)}}function sn(r,n){return"errors"===r.NAME?r:n(r.VAL)}function fn(r){var n={contents:""},t={length:0,first:void 0,last:void 0};return D(r,(function(r){return"errors"===r.NAME?e(r.VAL,(function(r){return I(t,r)})):void(n.contents=n.contents+r.VAL)})),R(t)?{NAME:"data",VAL:n.contents}:{NAME:"errors",VAL:O(t)}}function _n(r){var n=r.stack,t=r.components;return{render:function(r,e,a){var o=f.validate(r);if(void 0===o)return{NAME:"errors",VAL:[L(n)]};if("errors"===o.NAME)return{NAME:"errors",VAL:[o.VAL]};var i=o.VAL;return fn(Hr(i.ast,e,a,{components:t,stack:{hd:{TAG:0,_0:i.name},tl:n}},_n,on,un,fn))},return:an,error:function(r){return{NAME:"errors",VAL:[$(r,n)]}},mapChild:cn,flatMapChild:sn}}var vn={make:function(r){return en({components:r,stack:0})}},An={makeAst:function(r,n){return br(n,r)},make:function(r,n){return function(r,n){var t=br(r,n);return function(r,n,e){return r.render(t,n,e)}}(n,r)}},ln=Object.freeze({__proto__:null,Async:vn,make:function(r){return _n({components:r,stack:0})}});export{An as Compile,ln as Environment};
//# sourceMappingURL=acutis.mjs.map
