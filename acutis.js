/**!
 *    Copyright 2021 John Jackson
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */
function r(r){return void 0===r?{BS_PRIVATE_NESTED_SOME_NONE:0}:null!==r&&void 0!==r.BS_PRIVATE_NESTED_SOME_NONE?{BS_PRIVATE_NESTED_SOME_NONE:r.BS_PRIVATE_NESTED_SOME_NONE+1|0}:r}function n(r){if(null===r||void 0===r.BS_PRIVATE_NESTED_SOME_NONE)return r;var n=r.BS_PRIVATE_NESTED_SOME_NONE;return 0===n?void 0:{BS_PRIVATE_NESTED_SOME_NONE:n-1|0}}function t(n,t){if(t>=0&&t<n.length)return r(n[t])}function e(r,n){for(var t=0,e=r.length;t<e;++t)n(r[t])}function a(r,n){for(var t=r.length,e=new Array(t),a=0;a<t;++a)e[a]=n(r[a]);return e}var i={contents:0};function o(r){return i.contents=i.contents+1|0,r+"/"+i.contents}var u={map:function(r,n){return{_0:n(r._0),_1:a(r._1,n)}}};var c={$$location:function(r){return{character:r+1|0}},Stack:{nameToJson:function(r){if("number"==typeof r)return 0===r?"match":"map";switch(0|r.TAG){case 0:var n=r._0;return void 0!==n?n:null;case 1:return"section: "+r.component+"#"+r.section;case 2:return r._0}}}};var s={toString:function(r){switch(0|r.TAG){case 0:return"[text]: "+r._1;case 1:return"{*"+r._1+"*}";case 2:return'"'+r._1+'"';case 3:return String(r._1);case 4:return"true";case 5:return"false";case 6:return"null";case 7:return",";case 8:return":";case 9:return"[";case 10:return"]";case 11:return"{";case 12:return"}";case 13:return"...";case 15:return"/";case 16:return"#";case 17:return"=";case 14:case 18:return r._1;case 19:return"~";case 20:return"?";case 21:return"&";case 22:return"{{";case 23:return"[end of file]"}},toLocation:function(r){return r._0}};var f={make:function(r){return{data:r,acutis_is_valid:"ACUTIS_IS_VALID"}},validate:function(n){if("ACUTIS_IS_VALID"===n.acutis_is_valid)return r(n.data)}};var A={toString:function(r){var n=r.NAME;return"Object"===n?"object":"Binding"===n?"binding: `"+r.VAL[1]+"`":"Number"===n?"number":"True"===n||"False"===n?"boolean":"Array"===n||"ArrayWithTailBinding"===n?"array":"Null"===n?"null":"string"},toLocation:function(r){var n=r.NAME;return"True"===n||"Null"===n||"False"===n?r.VAL:r.VAL[0]}};function _(r){return a(function(r){var n=function(r){for(var n=r,t=0;;){if(!n)return t;t=t+1|0,n=n.tl}}(r),t=new Array(n);return function(r,n,t){for(;;){var e=t,a=n;if(!e)return;r[a]=e.hd,t=e.tl,n=a+1|0}}(t,0,r),t}(r),c.Stack.nameToJson)}var v=o("Debug-AcutisLang.CompileError");function l(r,n){throw{RE_EXN_ID:v,_1:{message:"Unexpected end of file.",kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function d(r,n){throw{RE_EXN_ID:v,_1:{message:"Unterminated comment.",kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function T(r,n){throw{RE_EXN_ID:v,_1:{message:"Unterminated string.",kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function G(r,n,t){throw{RE_EXN_ID:v,_1:{message:'Invalid character: "'+t+'".',kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function h(r,n,t,e){throw{RE_EXN_ID:v,_1:{message:'Unexpected character: "'+t+'". Expected: "'+e+'".',kind:"Syntax",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function p(r,n){throw{RE_EXN_ID:v,_1:{message:'Unexpected token: "'+s.toString(r)+'".',kind:"Parse",location:c.$$location(s.toLocation(r)),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function E(r,n){throw{RE_EXN_ID:v,_1:{message:'Bad map type: "'+A.toString(r)+'". I can only map bindings and arrays.',kind:"Parse",location:c.$$location(A.toLocation(r)),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}function m(r){if("number"==typeof r)switch(r){case 0:case 1:return"boolean";case 2:return"null"}else switch(0|r.TAG){case 0:return"string";case 1:return"number";case 2:return"object";case 3:return"array"}}function g(r,n,t){return{message:'Component "'+n+'" does not exist.',kind:"Render",location:c.$$location(r),path:_(t),exn:void 0}}function N(r,n,t){var e=m(r);return{message:"This pattern is type "+A.toString(n)+" but the data is type "+e+".",kind:"Type",location:c.$$location(A.toLocation(n)),path:_(t),exn:void 0}}function k(r,n,t,e){var a=m(r);return{message:'"'+t+'" is type '+A.toString(n)+" but the data is type "+a+".",kind:"Type",location:c.$$location(A.toLocation(n)),path:_(e),exn:void 0}}function b(r,n,t){return{message:'"'+n+'" is bound multiple times in this pattern.',kind:"Pattern",location:c.$$location(r),path:_(t),exn:void 0}}function L(r,n){return{message:"None of the patterns match the data. Consider a catch-all case to avoid this.",kind:"Pattern",location:c.$$location(r),path:_(n),exn:void 0}}function V(r,n){return{message:"The number of patterns does not match the number of data.",kind:"Pattern",location:c.$$location(r),path:_(n),exn:void 0}}function w(r,n,t,e){return{message:'"'+n+'" is type '+m(t)+". I can only echo strings and numbers.",kind:"Render",location:c.$$location(r),path:_(e),exn:void 0}}function y(r,n,t){return{message:'Binding "'+n+'" does not exist.',kind:"Render",location:c.$$location(r),path:_(t),exn:void 0}}function M(r,n,t){return{message:'Template child "'+n+'" does not exist.',kind:"Render",location:c.$$location(r),path:_(t),exn:void 0}}function x(r,n,t,e){return{message:'"'+n+'" is a '+m(t)+". I can only map arrays.",kind:"Type",location:c.$$location(r),path:_(e),exn:void 0}}function S(r){return{message:"A template AST was not valid. Did you forget to compile one?",kind:"Render",location:void 0,path:_(r),exn:void 0}}function $(n,t){return{message:"An exception was thrown while rendering this template. This is probably due to malformed input.",kind:"Compile",location:void 0,path:[void 0!==t?t:null],exn:r(n)}}function I(n,t){return{message:"An exception was thrown while rendering a template component.",kind:"Render",location:void 0,path:_(t),exn:r(n)}}function R(r,n){return{message:r,kind:"Render",location:void 0,path:_(n),exn:void 0}}function D(r){r.length=0,r.first=void 0,r.last=void 0}function B(r,n){var t={content:n,next:void 0},e=r.last;void 0!==e?(r.length=r.length+1|0,e.next=t,r.last=t):(r.length=1,r.first=t,r.last=t)}function P(r){return 0===r.length}function O(r,n){for(var t=r.first;;){var e=t;if(void 0===e)return;n(e.content),t=e.next}}function X(r,n){if(!(r.length<=0)){var t=n.last;return void 0!==t?(n.length=n.length+r.length|0,t.next=r.first,n.last=r.last,D(r)):(n.length=r.length,n.first=r.first,n.last=r.last,D(r))}}function j(r){var n=new Array(r.length);return function(r,n,t){for(;;){var e=t,a=r;if(void 0===e)return;n[a]=e.content,t=e.next,r=a+1|0}}(0,n,r.first),n}function C(r,n){return r.str.charAt(r.position+n|0)}function F(r){return r.str.charAt(r.position)}function U(r){r.position=r.position+1|0}function W(r){var n=F(r);return U(r),n}function z(r,n){r.position=r.position+n|0}function J(r,n){var t=r.position,e=function(r,n){for(var t=r.position;!n(r.str.charAt(t));)t=t+1|0;return t}(r,n);return r.position=e,r.str.slice(t,e)}function Z(r,n){var t=r.position;return r.position=r.position+n|0,r.str.slice(t,r.position)}function q(r){switch(r){case"+":case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"e":return!1;default:return!0}}function H(r,n){for(var t=r.position,e=0;;){var a=e;switch(C(r,a)){case"":return B(n,{TAG:0,_0:t,_1:Z(r,a)}),3;case"{":switch(C(r,a+1|0)){case"%":return B(n,{TAG:0,_0:t,_1:Z(r,a)}),z(r,2),1;case"*":return B(n,{TAG:0,_0:t,_1:Z(r,a)}),z(r,2),2;case"{":return B(n,{TAG:0,_0:t,_1:Z(r,a)}),z(r,2),0;default:e=a+2|0;continue}default:e=a+1|0;continue}}}function K(r,n){for(var t=r.position,e=0,a=0;;){var i=a,o=e;switch(C(r,o)){case"":return d(t,n);case"*":if("}"===C(r,o+1|0)){if(0===i){var u=Z(r,o);return z(r,2),u}a=i-1|0,e=o+2|0;continue}e=o+2|0;continue;case"{":if("*"===C(r,o+1|0)){a=i+1|0,e=o+2|0;continue}e=o+1|0;continue;default:e=o+1|0;continue}}}var Q=/\\"/g;function Y(r,n){for(var t=r.position,e=0;;){var a=e;switch(C(r,a)){case"":return T(t,n);case'"':var i=Z(r,a).replace(Q,'"');return U(r),i;case"\\":switch(C(r,a+1|0)){case'"':case"\\":e=a+2|0;continue;default:e=a+1|0;continue}default:e=a+1|0;continue}}}function rr(r,n){var t,e=r.position,a=J(r,q),i=(t=parseFloat(a),isNaN(t)?void 0:t);return void 0!==i?i:function(r,n,t){throw{RE_EXN_ID:v,_1:{message:'"'+t+'" is an illegal identifier name.',kind:"Parse",location:c.$$location(r),path:[void 0!==n?n:null],exn:void 0},Error:new Error}}(e,n,a)}var nr=/^[a-zA-Z0-9_]$/;function tr(r){return!nr.test(r)}var er=/^[a-z_]$/,ar=/^[A-Z]$/;function ir(r,n){var t=J(r,tr);switch(t){case"false":return{TAG:5,_0:n};case"null":return{TAG:6,_0:n};case"true":return{TAG:4,_0:n};default:return{TAG:18,_0:n,_1:t}}}function or(r,n,t,e){for(var a=!0;a;){var i=r.position,o=F(r),u=0;if(o===e)U(r),a=!1;else switch(o){case"":l(i,t);break;case"\t":case"\n":case"\r":case" ":U(r);break;case'"':U(r),B(n,{TAG:2,_0:i,_1:Y(r,t)});break;case"#":U(r),B(n,{TAG:16,_0:i});break;case"&":U(r),B(n,{TAG:21,_0:i});break;case",":U(r),B(n,{TAG:7,_0:i});break;case".":var c=Z(r,3);"..."===c?B(n,{TAG:13,_0:i}):h(i,t,c,"...");break;case"/":U(r),B(n,{TAG:15,_0:i});break;case"-":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":u=1;break;case":":U(r),B(n,{TAG:8,_0:i});break;case"=":U(r),B(n,{TAG:17,_0:i});break;case"?":U(r),B(n,{TAG:20,_0:i});break;case"[":U(r),B(n,{TAG:9,_0:i});break;case"]":U(r),B(n,{TAG:10,_0:i});break;case"{":U(r),B(n,{TAG:11,_0:i});break;case"}":U(r),B(n,{TAG:12,_0:i});break;case"~":U(r),B(n,{TAG:19,_0:i});break;default:er.test(o)?B(n,ir(r,i)):ar.test(o)?B(n,{TAG:14,_0:i,_1:J(r,tr)}):G(i,t,o)}1===u&&B(n,{TAG:3,_0:i,_1:rr(r,t)})}}function ur(r){return function(r){var n=r.first;if(void 0!==n)return n.content;throw{RE_EXN_ID:"Not_found",Error:new Error}}(r.tokens)}function cr(r){return function(r){var n=r.first;if(void 0!==n){var t=n.next;return void 0===t?(D(r),n.content):(r.length=r.length-1|0,r.first=t,n.content)}throw{RE_EXN_ID:"Not_found",Error:new Error}}(r.tokens)}function sr(r){return r.name}var fr=o("Caml_js_exceptions.Error");function Ar(r){return function(r){return null!=r&&"string"==typeof r.RE_EXN_ID}(r)?r:{RE_EXN_ID:fr,_1:r}}function _r(r,n){switch(0|r.TAG){case 2:return{NAME:"String",VAL:[r._0,r._1]};case 3:return{NAME:"Number",VAL:[r._0,r._1]};case 4:return{NAME:"True",VAL:r._0};case 5:return{NAME:"False",VAL:r._0};case 6:return{NAME:"Null",VAL:r._0};case 9:var t=r._0,e=cr(n);if(10===e.TAG)return{NAME:"Array",VAL:[t,[]]};var a={length:0,first:void 0,last:void 0};for(B(a,_r(e,n));;){var i=cr(n);switch(0|i.TAG){case 7:var o=cr(n);if(13===o.TAG){var u=cr(n);if(18!==u.TAG)return p(u,sr(n));var c=cr(n);return 10===c.TAG?{NAME:"ArrayWithTailBinding",VAL:[t,j(a),{NAME:"Binding",VAL:[u._0,u._1]}]}:p(c,sr(n))}B(a,_r(o,n));continue;case 10:return{NAME:"Array",VAL:[t,j(a)]};default:return p(i,sr(n))}}case 11:var s=r._0,f=cr(n);if(12===f.TAG)return{NAME:"Object",VAL:[s,[]]};var A={length:0,first:void 0,last:void 0};for(B(A,vr(f,n));;){var _=cr(n);switch(0|_.TAG){case 7:B(A,vr(cr(n),n));continue;case 12:return{NAME:"Object",VAL:[s,j(A)]};default:return p(_,sr(n))}}case 18:return{NAME:"Binding",VAL:[r._0,r._1]};default:return p(r,sr(n))}}function vr(r,n){switch(0|r.TAG){case 2:var t=cr(n);return 8===t.TAG?[r._1,_r(cr(n),n)]:p(t,sr(n));case 18:var e=r._1;return 8!==ur(n).TAG?[e,{NAME:"Binding",VAL:[r._0,e]}]:(cr(n),[e,_r(cr(n),n)]);default:return p(r,sr(n))}}function lr(r){for(var n=_r(cr(r),r),t={length:0,first:void 0,last:void 0};;){if(7!==ur(r).TAG)return{_0:n,_1:j(t)};cr(r),B(t,_r(cr(r),r))}}function dr(r){var n=cr(r);return 18===n.TAG?[n._0,n._1]:p(n,sr(r))}function Tr(r){for(var n=dr(r),t={length:0,first:void 0,last:void 0};;){if(7!==ur(r).TAG)return{_0:n,_1:j(t)};cr(r),B(t,dr(r))}}function Gr(r,n,t){switch(0|r.TAG){case 2:return{TAG:2,_0:r._1,_1:t};case 3:return{TAG:3,_0:r._1,_1:t};case 18:return{TAG:0,_0:r._0,_1:r._1,_2:t};default:return p(r,sr(n))}}function hr(r){var n=cr(r);switch(0|n.TAG){case 14:return{TAG:1,_0:n._0,_1:n._1};case 21:return Gr(cr(r),r,0);default:return Gr(n,r,1)}}function pr(r){for(var n=hr(r),t={length:0,first:void 0,last:void 0};;){var e=cr(r);switch(0|e.TAG){case 0:case 19:return[e,{_0:n,_1:j(t)}];case 20:B(t,hr(r));continue;default:return p(e,sr(r))}}}function Er(r){switch(0|r.TAG){case 15:return!0;case 18:return"with"===r._1;default:return!1}}function mr(r){return 23===r.TAG}function gr(r){return 15===r.TAG}function Nr(r,n,t){for(var e={length:0,first:void 0,last:void 0},a=r;;){var i=a;if(t(i))return[i,j(e)];switch(0|i.TAG){case 0:var o=i._1,u=cr(n);if(19===u.TAG){B(e,{TAG:0,_0:o,_1:1}),a=cr(n);continue}B(e,{TAG:0,_0:o,_1:3}),a=u;continue;case 1:a=cr(n);continue;case 14:B(e,Lr(i._0,i._1,n)),a=cr(n);continue;case 18:var c=i._0;switch(i._1){case"map":var s=_r(cr(n),n),f=s.NAME;B(e,{TAG:3,_0:c,_1:"Array"===f||"ArrayWithTailBinding"===f||"Binding"===f?s:E(s,sr(n)),_2:br(n,"map")}),a=cr(n);continue;case"match":B(e,{TAG:2,_0:c,_1:Tr(n),_2:br(n,"match")}),a=cr(n);continue;default:return p(i,sr(n))}case 19:var A=cr(n);if(0!==A.TAG)return p(A,sr(n));var _=A._1,v=cr(n);if(19===v.TAG){B(e,{TAG:0,_0:_,_1:2}),a=cr(n);continue}B(e,{TAG:0,_0:_,_1:0}),a=v;continue;case 22:var l=pr(n);B(e,{TAG:1,_0:i._0,_1:l[1]}),a=l[0];continue;default:return p(i,sr(n))}}}function kr(r){for(var n=lr(r),t={length:0,first:void 0,last:void 0};;){var e=cr(r);if(18!==e.TAG||"with"!==e._1){var a=Nr(e,r,Er);return[a[0],{patterns:{_0:n,_1:j(t)},ast:a[1]}]}B(t,lr(r))}}function br(r,n){var t=cr(r);if(18!==t.TAG)return p(t,sr(r));if("with"!==t._1)return p(t,sr(r));for(var e=kr(r),a=e[1],i={length:0,first:void 0,last:void 0},o=e[0];;){if(15===o.TAG){var u=cr(r);return 18===u.TAG&&u._1===n?{_0:a,_1:j(i)}:p(u,sr(r))}var c=kr(r);B(i,c[1]),o=c[0]}}function Lr(r,n,t){var e=function(r){var n={length:0,first:void 0,last:void 0},t={length:0,first:void 0,last:void 0},e=cr(r);for(;;){var a=e;switch(0|a.TAG){case 14:var i=a._1,o=cr(r);if(17!==o.TAG){B(t,[i,{TAG:0,_0:i}]),e=o;continue}var u=cr(r);switch(0|u.TAG){case 14:B(t,[i,{TAG:0,_0:u._1}]),e=cr(r);continue;case 16:var c=Nr(cr(r),r,gr),s=cr(r);if(16!==s.TAG)return p(s,sr(r));B(t,[i,{TAG:1,_0:c[1]}]),e=cr(r);continue;default:return p(u,sr(r))}case 18:var f=a._1,A=cr(r);if(17===A.TAG){B(n,[f,_r(cr(r),r)]),e=cr(r);continue}B(n,[f,{NAME:"Binding",VAL:[a._0,f]}]),e=A;continue;default:return[a,n,t]}}}(t),a=e[2],i=e[1],o=e[0];if(15===o.TAG)return{TAG:4,loc:r,name:n,props:j(i),children:j(a)};var u=Nr(o,t,gr),c=cr(t);return 14===c.TAG&&n===c._1?(B(a,["Children",{TAG:1,_0:u[1]}]),{TAG:4,loc:r,name:n,props:j(i),children:j(a)}):p(c,sr(t))}function Vr(r,n){try{var t=function(r,n){for(var t={str:n,position:0},e={length:0,first:void 0,last:void 0},a=H(t,e);;)switch(a){case 0:var i=t.position;"~"===F(t)&&(B(e,{TAG:19,_0:t.position}),U(t)),B(e,{TAG:22,_0:i}),or(t,e,r,"}");var o=W(t);if("}"!==o)return h(t.position,r,o,"}");a=H(t,e);continue;case 1:or(t,e,r,"%");var u=W(t);if("}"!==u)return h(t.position,r,u,"}");a=H(t,e);continue;case 2:B(e,{TAG:1,_0:t.position,_1:K(t,r)}),a=H(t,e);continue;case 3:return B(e,{TAG:23,_0:t.position}),{tokens:e,name:r}}}(r,n),e=Nr(cr(t),t,mr);return f.make({NAME:"data",VAL:{ast:e[1],name:r}})}catch(n){var a=Ar(n);return a.RE_EXN_ID===v?f.make({NAME:"errors",VAL:a._1}):f.make({NAME:"errors",VAL:$(a,r)})}}function wr(n,t){if(t in n)return r(n[t])}function yr(r){var n=typeof r;return"string"===n?{TAG:0,_0:r}:"number"===n?{TAG:1,_0:r}:"boolean"===n?!0===r?1:0:null===r?2:Array.isArray(r)?{TAG:3,_0:r}:{TAG:2,_0:r}}function Mr(r,n){return 0===r.TAG?{TAG:0,_0:n(r._0)}:{TAG:1,_0:r._0}}function xr(r){return void 0!==r?r.h:0}function Sr(r,n,t,e){var a=xr(r),i=xr(e);return{k:n,v:t,h:a>=i?a+1|0:i+1|0,l:r,r:e}}function $r(r,n,t,e){var a=void 0!==r?r.h:0,i=void 0!==e?e.h:0;if(a>(i+2|0)){var o=r.l,u=r.r;return xr(o)>=xr(u)?Sr(o,r.k,r.v,Sr(u,n,t,e)):Sr(Sr(o,r.k,r.v,u.l),u.k,u.v,Sr(u.r,n,t,e))}if(i<=(a+2|0))return{k:n,v:t,h:a>=i?a+1|0:i+1|0,l:r,r:e};var c=e.l,s=e.r;return xr(s)>=xr(c)?Sr(Sr(r,n,t,c),e.k,e.v,s):Sr(Sr(r,n,t,c.l),c.k,c.v,Sr(c.r,e.k,e.v,s))}function Ir(r,n,t){if(void 0===r)return{k:n,v:t,h:1,l:void 0,r:void 0};var e,a,i=r.k;if(n===i)return a=t,(e=r).v===a?e:{k:e.k,v:a,h:e.h,l:e.l,r:e.r};var o=r.v;return n<i?$r(Ir(r.l,n,t),i,o,r.r):$r(r.l,i,o,Ir(r.r,n,t))}var Rr=function(r,n){for(;;){var t=r;if(void 0===t)return!1;var e=t.k;if(n===e)return!0;r=n<e?t.l:t.r}},Dr=function r(n,t){for(;;){var e=n;if(void 0===e)return;r(e.l,t),t(e.k,e.v),n=e.r}};function Br(r,e){for(var a={length:0,first:void 0,last:void 0},i=0;;){var o=i,u=t(r,o);if(void 0===u)return{TAG:0,_0:a};var c=e(n(u));if(0!==c.TAG)return c;B(a,c._0),i=o+1|0}}function Pr(r,t,e){var a=r.NAME;if("Object"===a)return Mr(Br(r.VAL[1],(function(r){var n=r[0];return Mr(Pr(r[1],t,e),(function(r){return[n,r]}))})),(function(r){var n={};return O(r,(function(r){n[r[0]]=r[1]})),n}));if("Binding"!==a)return"False"===a?{TAG:0,_0:!1}:"Array"===a||"ArrayWithTailBinding"===a?Mr(Or(r,t,e),(function(r){return r})):"Null"===a?{TAG:0,_0:null}:"True"===a?{TAG:0,_0:!0}:{TAG:0,_0:r.VAL[1]};var i=r.VAL,o=i[1],u=wr(t,o);return void 0!==u?{TAG:0,_0:n(u)}:{TAG:1,_0:y(i[0],o,e)}}function Or(r,t,e){if("Array"===r.NAME)return Mr(Br(r.VAL[1],(function(r){return Pr(r,t,e)})),j);var a=r.VAL,i=a[2].VAL,o=i[1],u=wr(t,o);if(void 0===u)return{TAG:1,_0:y(i[0],o,e)};var c=yr(n(u));if("number"==typeof c)return{TAG:1,_0:k(c,r,o,e)};if(3!==c.TAG)return{TAG:1,_0:k(c,r,o,e)};var s=c._0;return Mr(Br(a[1],(function(r){return Pr(r,t,e)})),(function(r){return function(r,n){for(var t=r.length,e=n.length,a=new Array(t+e|0),i=0;i<t;++i)a[i]=r[i];for(var o=0;o<e;++o)a[t+o|0]=n[o];return a}(j(r),s)}))}function Xr(r,n,t,e){return"_"===n?{TAG:0,_0:r}:Rr(r,n)?{TAG:1,_0:{TAG:1,loc:e,binding:n}}:{TAG:0,_0:Ir(r,n,t)}}function jr(r,e,a){var i,o,u=yr(e),c=r.NAME;if("Object"===c){var s=r.VAL[1];if(0===s.length)return"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:2===u.TAG?0===Object.keys(u._0).length?{TAG:0,_0:a}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if("number"==typeof u)return 2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if(2!==u.TAG)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};for(var f=u._0,A=a,_=0;;){var v=_,l=A,d=t(s,v);if(void 0===d)return{TAG:0,_0:l};var T=wr(f,d[0]);if(void 0===T)return{TAG:1,_0:0};var G=jr(d[1],n(T),l);if(0!==G.TAG)return G;_=v+1|0,A=G._0}}if("Binding"===c){var h=r.VAL;return Xr(a,h[1],e,h[0])}if("Number"===c)return"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:1===u.TAG?r.VAL[1]===u._0?{TAG:0,_0:a}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if("False"===c){if("number"!=typeof u)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};switch(u){case 0:return{TAG:0,_0:a};case 1:case 2:return{TAG:1,_0:0}}}else{if("ArrayWithTailBinding"===c){var p=r.VAL,E=p[2].VAL,m=E[1],g=E[0],N=p[1];if("number"==typeof u)return 2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};if(3!==u.TAG)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};var k=u._0;return i=Cr(N,k,a),o=function(r){return Xr(r,m,function(r,n){for(var t,e,a=r.length,i=n<0?(t=a+n|0)>(e=0)?t:e:n,o=a-i|0,u=new Array(o),c=0;c<o;++c)u[c]=r[i+c|0];return u}(k,N.length),g)},0===i.TAG?o(i._0):{TAG:1,_0:i._0}}if("Null"===c)return"number"==typeof u&&u>=2?{TAG:0,_0:a}:{TAG:1,_0:0};if("True"!==c){if("Array"!==c)return"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:0===u.TAG?r.VAL[1]===u._0?{TAG:0,_0:a}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}};var b=r.VAL[1];return 0!==b.length?"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:3===u.TAG?Cr(b,u._0,a):{TAG:1,_0:{TAG:0,data:u,pattern:r}}:"number"==typeof u?2===u?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}:3===u.TAG?0!==u._0.length?{TAG:1,_0:0}:{TAG:0,_0:a}:{TAG:1,_0:{TAG:0,data:u,pattern:r}}}if("number"!=typeof u)return{TAG:1,_0:{TAG:0,data:u,pattern:r}};switch(u){case 1:return{TAG:0,_0:a};case 0:case 2:return{TAG:1,_0:0}}}}function Cr(r,e,a){for(var i=a,o=0;;){var u=o,c=i,s=t(r,u);if(void 0===s)return{TAG:0,_0:c};var f=t(e,u);if(void 0===f)return{TAG:1,_0:0};var A=jr(s,n(f),c);if(0!==A.TAG)return A;o=u+1|0,i=A._0}}function Fr(r,e){for(var a,i=e._1,o=r._1,u=r._0,c=e._0,s=0;;){var f=s,A=jr(u,c,a);if(0!==A.TAG)return A;var _=A._0,v=t(o,f),l=t(i,f);if(void 0===v){if(void 0!==l)return{TAG:1,_0:1};var d={};return Dr(_,function(r){return function(n,t){r[n]=t}}(d)),{TAG:0,_0:d}}if(void 0===l)return{TAG:1,_0:1};s=f+1|0,a=_,c=n(l),u=v}}function Ur(r,n){for(var e=r.f,a=r.patterns,i=a._1,o=a._0,u=0;;){var c=u,s=Fr(o,n);if(0===s.TAG)return{TAG:0,_0:e(s._0)};var f=s._0;if("number"!=typeof f)return s;if(0!==f)return s;var A=t(i,c);if(void 0===A)return{TAG:1,_0:0};u=c+1|0,o=A}}function Wr(r){switch(r){case'"':return"&quot;";case"&":return"&amp;";case"'":return"&apos;";case"/":return"&#x2F;";case"<":return"&lt;";case"=":return"&#x3D;";case">":return"&gt;";case"`":return"&#x60;";default:return r}}function zr(r,n){if(!r)return n;for(var t=0,e="";;){var a=e,i=t,o=n.charAt(i);if(""===o)return a;e=a+Wr(o),t=i+1|0}}function Jr(r,t){var e=wr(r,t);return void 0!==e?n(e):null}function Zr(r,n){var t=yr(Jr(r,n));if("number"==typeof t)return{TAG:1,_0:t};switch(0|t.TAG){case 0:return{TAG:0,_0:t._0};case 1:return{TAG:0,_0:String(t._0)};default:return{TAG:1,_0:t}}}function qr(r){return function(n){return 0!==n._1.length?n:{_0:n._0,_1:[{NAME:"Binding",VAL:[r,"_"]}]}}}function Hr(r,n,e,a){var i=function(r,n){for(var e=r._1,a=r._0,i=0;;){var o=i,u=Ur(a,n);if(0===u.TAG)return u;var c=u._0;if("number"!=typeof c)return u;if(0!==c)return u;var s=t(e,o);if(void 0===s)return{TAG:1,_0:0};i=o+1|0,a=s}}(r,n);if(0===i.TAG)return i;var o=i._0;return"number"==typeof o?0===o?{TAG:1,_0:L(e,a)}:{TAG:1,_0:V(e,a)}:0===o.TAG?{TAG:1,_0:N(o.data,o.pattern,a)}:{TAG:1,_0:b(o.loc,o.binding,a)}}function Kr(r){for(var n=0;;){var t=n;switch(r.charAt(t)){case"\t":case"\n":case"\r":case" ":n=t+1|0;continue;default:return r.slice(t)}}}function Qr(r){for(var n=r.length;;){var t=n;switch(r.charAt(t-1|0)){case"\t":case"\n":case"\r":case" ":n=t-1|0;continue;default:return r.slice(0,t)}}}function Yr(r,a,i,o,c,s,f,A){var _=o.stack,v=o.components,l=c(o),d={length:0,first:void 0,last:void 0};return e(r,(function(r){switch(0|r.TAG){case 0:var T,G=r._0;switch(r._1){case 0:T=Kr(G);break;case 1:T=Qr(G);break;case 2:T=Kr(Qr(G));break;case 3:T=G}return B(d,l.return(T));case 1:var h=r._1;return B(d,function(r,e,a,i,o,u,c){for(var s=r,f=0;;){var A=f,_=s;switch(0|_.TAG){case 0:var v=_._1,l=Zr(a,v);if(0===l.TAG)return u.return(zr(_._2,l._0));var d=l._0,T=t(e,A);if("number"==typeof d&&d>=2&&void 0!==T){f=A+1|0,s=T;continue}return c([w(_._0,v,d,i)]);case 1:var G=_._1,h=wr(o,G);if(void 0!==h)return n(h);var p=t(e,A);if(void 0===p)return c([M(_._0,G,i)]);f=A+1|0,s=p;continue;case 2:return u.return(zr(_._1,_._0));case 3:return u.return(zr(_._1,String(_._0)))}}}(h._0,h._1,a,_,i,l,s));case 2:var p=Hr(u.map(r._2,(function(r){var n=r.ast;return{patterns:r.patterns,f:function(r){return Yr(n,Object.assign({},a,r),i,{components:o.components,stack:{hd:0,tl:_}},c,s,f,A)}}})),u.map(r._1,(function(r){return Jr(a,r[1])})),r._0,_);return 0===p.TAG?X(p._0,d):B(d,s([p._0]));case 3:var E,m=r._2,N=r._1,k=r._0,b=N.NAME;if("Array"===b||"ArrayWithTailBinding"===b)E=Or(N,a,_);else{var L=N.VAL,V=L[1],y=L[0],S=yr(Jr(a,V));E="number"==typeof S||3!==S.TAG?{TAG:1,_0:x(y,V,S,_)}:{TAG:0,_0:S._0}}return 0===E.TAG?function(r,n){for(var t=0,e=r.length;t<e;++t)n(t,r[t])}(E._0,(function(r,n){var t=Hr(u.map(m,(function(n){var t=n.ast;return{patterns:u.map(n.patterns,qr(k)),f:function(n){return Yr(t,Object.assign({},a,n),i,{components:o.components,stack:{hd:{TAG:2,_0:r},tl:{hd:1,tl:_}}},c,s,f,A)}}})),{_0:n,_1:[r]},k,_);return 0===t.TAG?X(t._0,d):B(d,s([t._0]))})):B(d,s([E._0]));case 4:var $=r.name,R=r.loc,D=wr(v,$);if(void 0===D)return B(d,s([g(R,$,_)]));var O={},C={},F={length:0,first:void 0,last:void 0};return e(r.children,(function(r){var t=r[1],e=r[0];if(0===t.TAG){var u=t._0,v=wr(i,u);return void 0!==v?void(C[e]=n(v)):B(F,M(R,u,_))}C[e]=A(Yr(t._0,a,i,{components:o.components,stack:{hd:{TAG:1,component:$,section:e},tl:_}},c,s,f,A))})),e(r.props,(function(r){var n=Pr(r[1],a,_);if(0!==n.TAG)return B(F,n._0);O[r[0]]=n._0})),P(F)?B(d,f((function(){return D(l,O,C)}),(function(r){return s([I(r,_)])}))):B(d,s(j(F)))}})),d}function rn(r){return Promise.resolve({NAME:"data",VAL:r})}function nn(r){return Promise.resolve({NAME:"errors",VAL:r})}function tn(r,n){return r().catch((function(r){return n(r)}))}function en(r,n){return r.then((function(r){return"errors"===r.NAME?Promise.resolve(r):Promise.resolve({NAME:"data",VAL:n(r.VAL)})}))}function an(r,n){return r.then((function(r){return"errors"===r.NAME?Promise.resolve(r):n(r.VAL)}))}function on(r){var n={contents:""},t={length:0,first:void 0,last:void 0};return e(r,(function(r){return"errors"===r.NAME?e(r.VAL,(function(r){return B(t,r)})):void(n.contents=n.contents+r.VAL)})),P(t)?Promise.resolve({NAME:"data",VAL:n.contents}):Promise.resolve({NAME:"errors",VAL:j(t)})}function un(r){return Promise.all(j(r)).then(on)}function cn(r){var n=r.stack,t=r.components;return{render:function(r,e,a){var i=f.validate(r);if(void 0===i)return Promise.resolve({NAME:"errors",VAL:[S(n)]});if("errors"===i.NAME)return Promise.resolve({NAME:"errors",VAL:[i.VAL]});var o=i.VAL;return un(Yr(o.ast,e,a,{components:t,stack:{hd:{TAG:0,_0:o.name},tl:n}},cn,nn,tn,un))},return:rn,error:function(r){return Promise.resolve({NAME:"errors",VAL:[R(r,n)]})},mapChild:en,flatMapChild:an}}function sn(r){return{NAME:"data",VAL:r}}function fn(r){return{NAME:"errors",VAL:r}}function An(r,n){try{return r()}catch(r){return n(Ar(r))}}function _n(r,n){return"errors"===r.NAME?r:{NAME:"data",VAL:n(r.VAL)}}function vn(r,n){return"errors"===r.NAME?r:n(r.VAL)}function ln(r){var n={contents:""},t={length:0,first:void 0,last:void 0};return O(r,(function(r){return"errors"===r.NAME?e(r.VAL,(function(r){return B(t,r)})):void(n.contents=n.contents+r.VAL)})),P(t)?{NAME:"data",VAL:n.contents}:{NAME:"errors",VAL:j(t)}}function dn(r){var n=r.stack,t=r.components;return{render:function(r,e,a){var i=f.validate(r);if(void 0===i)return{NAME:"errors",VAL:[S(n)]};if("errors"===i.NAME)return{NAME:"errors",VAL:[i.VAL]};var o=i.VAL;return ln(Yr(o.ast,e,a,{components:t,stack:{hd:{TAG:0,_0:o.name},tl:n}},dn,fn,An,ln))},return:sn,error:function(r){return{NAME:"errors",VAL:[R(r,n)]}},mapChild:_n,flatMapChild:vn}}var Tn={make:function(r){return cn({components:r,stack:0})}},Gn={makeAst:function(r,n){return Vr(n,r)},make:function(r,n){return function(r,n){var t=Vr(r,n);return function(r,n,e){return r.render(t,n,e)}}(n,r)}},hn=Object.freeze({__proto__:null,Async:Tn,make:function(r){return dn({components:r,stack:0})}});export{Gn as Compile,hn as Environment};
//# sourceMappingURL=acutis.mjs.map
