/**!
 *    Copyright 2021 John Jackson
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */
function r(r){return void 0===r?{BS_PRIVATE_NESTED_SOME_NONE:0}:null!==r&&void 0!==r.BS_PRIVATE_NESTED_SOME_NONE?{BS_PRIVATE_NESTED_SOME_NONE:r.BS_PRIVATE_NESTED_SOME_NONE+1|0}:r}function n(r){if(null===r||void 0===r.BS_PRIVATE_NESTED_SOME_NONE)return r;var n=r.BS_PRIVATE_NESTED_SOME_NONE;return 0===n?void 0:{BS_PRIVATE_NESTED_SOME_NONE:n-1|0}}function t(n,t){if(t>=0&&t<n.length)return r(n[t])}function e(r,n){for(var t,e,a=r.length,o=n<0?(t=a+n|0)>(e=0)?t:e:n,i=a-o|0,c=new Array(i),u=0;u<i;++u)c[u]=r[o+u|0];return c}function a(r,n){for(var t=0,e=r.length;t<e;++t)n(r[t])}function o(r,n){if(!r)return 0;var t={hd:n(r.hd),tl:0};return function(r,n,t){for(;;){var e=n,a=r;if(!a)return;var o={hd:t(a.hd),tl:0};e.tl=o,n=o,r=a.tl}}(r.tl,t,n),t}function i(r){return function(r,n){for(;;){var t=n,e=r;if(!e)return t;n={hd:e.hd,tl:t},r=e.tl}}(r,0)}function c(r,n){for(;;){var t=r;if(!t)return;n(t.hd),r=t.tl}}var u={contents:0};function s(r){return u.contents=u.contents+1|0,r+"/"+u.contents}var _={map:function(r,n){return{_0:n(r._0),_1:o(r._1,n)}},toList:function(r){return{hd:r._0,tl:r._1}}},f=/^[a-zA-Z0-9_]$/;var A=/^[a-z_]$/;var d=/^[A-Z]$/;var l=/^[a-z_][a-zA-Z0-9_]*$/;var v={isEndOfIdentifier:function(r){return!f.test(r)},isValidIdentifierStart:function(r){return A.test(r)},isValidComponentStart:function(r){return d.test(r)},isLegalBinding:function(r){return!!l.test(r)&&!function(r){switch(r){case"false":case"null":case"true":return!0;default:return!1}}(r)}};var T={$$location:function(r){return{character:r+1|0}},Stack:{nameToJson:function(r){if("number"==typeof r)return 0===r?"match":"map";switch(0|r.TAG){case 0:var n=r._0;return void 0!==n?n:null;case 1:return"section: "+r.component+"#"+r.section;case 2:return r._0}}}};var G={toString:function(r){switch(0|r.TAG){case 0:return"[text]: "+r._1;case 1:return"{*"+r._1+"*}";case 2:return'"'+r._1+'"';case 3:return String(r._1);case 4:return",";case 5:return":";case 6:return"[";case 7:return"]";case 8:return"{";case 9:return"}";case 10:return"...";case 12:return"/";case 13:return"#";case 14:return"=";case 11:case 15:return r._1;case 16:return"~";case 17:return"?";case 18:return"{{";case 19:return r._1+"}";case 20:return"[end of file]"}},toLocation:function(r){return r._0}};var h={toString:function(r){switch(0|r.TAG){case 0:return"null";case 1:case 2:return"boolean";case 3:return"string";case 4:return"number";case 5:case 6:return"array";case 7:return"object";case 8:return"binding: `"+r._1+"`"}},toLocation:function(r){return 6===r.TAG?r.loc:r._0}};var p={make:function(r){return{data:r,acutis_is_valid:"ACUTIS_IS_VALID"}},validate:function(n){if("ACUTIS_IS_VALID"===n.acutis_is_valid)return r(n.data)}};function E(r){return function(r){var n=function(r){for(var n=r,t=0;;){if(!n)return t;t=t+1|0,n=n.tl}}(r),t=new Array(n);return function(r,n,t){for(;;){var e=t,a=n;if(!e)return;r[a]=e.hd,t=e.tl,n=a+1|0}}(t,0,r),t}(o(r,T.Stack.nameToJson))}var m=s("Debug-AcutisLang.CompileError");function g(r,n){return{message:"Unexpected end of file.",kind:"Syntax",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function w(r,n){return{message:"Unterminated comment.",kind:"Syntax",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function b(r,n){return{message:"Unterminated string.",kind:"Syntax",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function N(r,n,t){return{message:'"'+t+'" is an illegal identifier name.',kind:"Parse",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function k(r,n,t){return{message:'Invalid character: "'+t+'".',kind:"Syntax",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function y(r,n,t,e){return{message:'Unexpected character: "'+t+'". Expected: "'+e+'".',kind:"Syntax",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function L(r,n){var t=T.$$location(G.toLocation(r));return{message:'Unexpected token: "'+G.toString(r)+'".',kind:"Parse",location:t,path:[void 0!==n?n:null],exn:void 0}}function x(r,n,t){return{message:'"'+t+'" is a reserved name',kind:"Parse",location:T.$$location(r),path:[void 0!==n?n:null],exn:void 0}}function S(r){if("number"==typeof r)switch(r){case 0:case 1:return"boolean";case 2:return"null"}else switch(0|r.TAG){case 0:return"string";case 1:return"number";case 2:return"object";case 3:return"array"}}function V(r,n,t){return{message:'Component "'+n+'" does not exist.',kind:"Render",location:T.$$location(r),path:E(t),exn:void 0}}function $(r,n,t){var e=S(r);return{message:"This pattern is type "+h.toString(n)+" but the data is type "+e+".",kind:"Type",location:T.$$location(h.toLocation(n)),path:E(t),exn:void 0}}function I(r,n,t){return{message:'"'+n+'" is bound multiple times in this pattern.',kind:"Pattern",location:T.$$location(r),path:E(t),exn:void 0}}function M(r,n){return{message:"None of the patterns match the data. Consider a catch-all case to avoid this.",kind:"Pattern",location:T.$$location(r),path:E(n),exn:void 0}}function R(r,n){return{message:"The number of patterns does not match the number of data.",kind:"Pattern",location:T.$$location(r),path:E(n),exn:void 0}}function D(r,n,t,e){return{message:'"'+n+'" is type '+S(t)+". I can only echo strings and numbers.",kind:"Render",location:T.$$location(r),path:E(e),exn:void 0}}function P(r,n,t){return{message:'Template child "'+n+'" does not exist.',kind:"Render",location:T.$$location(r),path:E(t),exn:void 0}}function O(r,n,t,e){return{message:'"'+n+'" is a '+S(t)+". I can only map arrays.",kind:"Type",location:T.$$location(r),path:E(e),exn:void 0}}function X(r){return{message:"A template AST was not valid. Did you forget to compile one?",kind:"Render",location:void 0,path:E(r),exn:void 0}}function C(n,t){return{message:"An exception was thrown while rendering this template. This is probably due to malformed input.",kind:"Compile",location:void 0,path:[void 0!==t?t:null],exn:r(n)}}function B(n,t){return{message:"An exception was thrown while rendering a template component.",kind:"Render",location:void 0,path:E(t),exn:r(n)}}function j(r,n){return{message:r,kind:"Render",location:void 0,path:E(n),exn:void 0}}function U(r){r.length=0,r.first=void 0,r.last=void 0}function z(r,n){var t={content:n,next:void 0},e=r.last;void 0!==e?(r.length=r.length+1|0,e.next=t,r.last=t):(r.length=1,r.first=t,r.last=t)}function Z(r){return 0===r.length}function F(r,n){for(var t=r.first;;){var e=t;if(void 0===e)return;n(e.content),t=e.next}}function J(r,n){if(!(r.length<=0)){var t=n.last;return void 0!==t?(n.length=n.length+r.length|0,t.next=r.first,n.last=r.last,U(r)):(n.length=r.length,n.first=r.first,n.last=r.last,U(r))}}function q(r){var n=new Array(r.length);return function(r,n,t){for(;;){var e=t,a=r;if(void 0===e)return;n[a]=e.content,t=e.next,r=a+1|0}}(0,n,r.first),n}function H(r,n){return r.str.charAt(r.position+n|0)}function K(r){return r.str.charAt(r.position)}function Q(r){r.position=r.position+1|0}function W(r){var n=K(r);return Q(r),n}function Y(r,n){r.position=r.position+n|0}function rr(r,n){var t=r.position,e=function(r,n){for(var t=r.position;!n(r.str.charAt(t));)t=t+1|0;return t}(r,n);return r.position=e,r.str.slice(t,e)}function nr(r,n){var t=r.position;return r.position=r.position+n|0,r.str.slice(t,r.position)}function tr(r){switch(r){case"+":case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"E":case"e":return!1;default:return!0}}function er(r,n){for(var t=r.position,e=0;;){var a=e;switch(H(r,a)){case"":return z(n,{TAG:0,_0:t,_1:nr(r,a)}),3;case"{":switch(H(r,a+1|0)){case"%":return z(n,{TAG:0,_0:t,_1:nr(r,a)}),Y(r,2),1;case"*":return z(n,{TAG:0,_0:t,_1:nr(r,a)}),Y(r,2),2;case"{":return z(n,{TAG:0,_0:t,_1:nr(r,a)}),Y(r,2),0;default:e=a+2|0;continue}default:e=a+1|0;continue}}}function ar(r,n){for(var t=r.position,e=0,a=0;;){var o=a,i=e;switch(H(r,i)){case"":throw{RE_EXN_ID:m,_1:w(t,n),Error:new Error};case"*":if("}"===H(r,i+1|0)){if(0===o){var c=nr(r,i);return Y(r,2),c}a=o-1|0,e=i+2|0;continue}e=i+2|0;continue;case"{":if("*"===H(r,i+1|0)){a=o+1|0,e=i+2|0;continue}e=i+1|0;continue;default:e=i+1|0;continue}}}var or=/\\"/g;function ir(r,n){for(var t=r.position,e=0;;){var a=e;switch(H(r,a)){case"":throw{RE_EXN_ID:m,_1:b(t,n),Error:new Error};case'"':var o=nr(r,a).replace(or,'"');return Q(r),o;case"\\":switch(H(r,a+1|0)){case'"':case"\\":e=a+2|0;continue;default:e=a+1|0;continue}default:e=a+1|0;continue}}}function cr(r,n){var t,e=r.position,a=rr(r,tr),o=(t=parseFloat(a),isNaN(t)?void 0:t);if(void 0!==o)return o;throw{RE_EXN_ID:m,_1:N(e,n,a),Error:new Error}}function ur(r,n,t,e){for(var a=!0;a;){var o=r.position,i=K(r),c=0;if(i===e)Q(r),z(n,{TAG:19,_0:o,_1:e}),a=!1;else switch(i){case"":throw{RE_EXN_ID:m,_1:g(o,t),Error:new Error};case"\t":case"\n":case"\r":case" ":Q(r);break;case'"':Q(r),z(n,{TAG:2,_0:o,_1:ir(r,t)});break;case"#":z(n,{TAG:13,_0:o}),Q(r);break;case",":z(n,{TAG:4,_0:o}),Q(r);break;case".":var u=nr(r,3);if("..."!==u)throw{RE_EXN_ID:m,_1:y(o,t,u,"..."),Error:new Error};z(n,{TAG:10,_0:o});break;case"/":z(n,{TAG:12,_0:o}),Q(r);break;case"-":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=1;break;case":":z(n,{TAG:5,_0:o}),Q(r);break;case"=":z(n,{TAG:14,_0:o}),Q(r);break;case"?":Q(r),z(n,{TAG:17,_0:o});break;case"[":z(n,{TAG:6,_0:o}),Q(r);break;case"]":z(n,{TAG:7,_0:o}),Q(r);break;case"{":z(n,{TAG:8,_0:o}),Q(r);break;case"}":z(n,{TAG:9,_0:o}),Q(r);break;case"~":Q(r),K(r)===e?(Q(r),z(n,{TAG:19,_0:o,_1:e}),z(n,{TAG:16,_0:o}),a=!1):z(n,{TAG:16,_0:o});break;default:if(v.isValidIdentifierStart(i))z(n,{TAG:15,_0:o,_1:rr(r,v.isEndOfIdentifier)});else{if(!v.isValidComponentStart(i))throw{RE_EXN_ID:m,_1:k(o,t,i),Error:new Error};z(n,{TAG:11,_0:o,_1:rr(r,v.isEndOfIdentifier)})}}1===c&&z(n,{TAG:3,_0:o,_1:cr(r,t)})}}function sr(r){return function(r){var n=r.first;if(void 0!==n)return n.content;throw{RE_EXN_ID:"Not_found",Error:new Error}}(r.tokens)}function _r(r){return function(r){var n=r.first;if(void 0!==n){var t=n.next;return void 0===t?(U(r),n.content):(r.length=r.length-1|0,r.first=t,n.content)}throw{RE_EXN_ID:"Not_found",Error:new Error}}(r.tokens)}function fr(r){return r.name}var Ar=s("Caml_js_exceptions.Error");function dr(r){return function(r){return null!=r&&"string"==typeof r.RE_EXN_ID}(r)?r:{RE_EXN_ID:Ar,_1:r}}function lr(r,n){throw{RE_EXN_ID:m,_1:L(r,fr(n)),Error:new Error}}function vr(r,n){switch(0|r.TAG){case 2:return{TAG:3,_0:r._0,_1:r._1};case 3:return{TAG:4,_0:r._0,_1:r._1};case 6:var t=r._0,e=_r(n);if(7===e.TAG)return{TAG:5,_0:t,_1:0};for(var a={hd:vr(e,n),tl:0};;){var o=a,c=_r(n);switch(0|c.TAG){case 4:var u=_r(n);switch(0|u.TAG){case 10:var s=_r(n),_=_r(n);return 15===s.TAG?7===_.TAG?{TAG:6,loc:t,array:i(o),bindLoc:s._0,binding:s._1}:lr(_,n):lr(s,n);case 2:case 3:case 6:case 8:case 15:break;default:return lr(u,n)}a={hd:vr(u,n),tl:o};continue;case 7:return{TAG:5,_0:t,_1:i(o)};default:return lr(c,n)}}case 8:var f=r._0,A=_r(n);if(9===A.TAG)return{TAG:7,_0:f,_1:0};for(var d={hd:Tr(A,n),tl:0};;){var l=d,v=_r(n);switch(0|v.TAG){case 4:d={hd:Tr(_r(n),n),tl:l};continue;case 9:return{TAG:7,_0:f,_1:i(l)};default:return lr(v,n)}}case 15:var T=r._1,G=r._0;switch(T){case"false":return{TAG:1,_0:G};case"null":return{TAG:0,_0:G};case"true":return{TAG:2,_0:G};default:return{TAG:8,_0:G,_1:T}}default:return lr(r,n)}}function Tr(r,n){switch(0|r.TAG){case 2:case 15:break;default:return lr(r,n)}var t=r._1,e=r._0;if(5===sr(n).TAG)return _r(n),[t,vr(_r(n),n)];if(v.isLegalBinding(t))return[t,{TAG:8,_0:e,_1:t}];throw{RE_EXN_ID:m,_1:N(e,fr(n),t),Error:new Error}}function Gr(r){for(var n=vr(_r(r),r),t=0;;){var e=t;if(4!==sr(r).TAG)return{_0:n,_1:i(e)};_r(r),t={hd:vr(_r(r),r),tl:e}}}function hr(r){var n=_r(r);if(15!==n.TAG)return lr(n,r);var t=n._1,e=n._0;if(v.isLegalBinding(t))return[e,t];throw{RE_EXN_ID:m,_1:x(e,fr(r),t),Error:new Error}}function pr(r){for(var n=hr(r),t=0;;){var e=t;if(4!==sr(r).TAG)return{_0:n,_1:i(e)};_r(r),t={hd:hr(r),tl:e}}}function Er(r){var n=_r(r);switch(0|n.TAG){case 2:return{TAG:2,_0:n._1};case 3:return{TAG:3,_0:n._1};case 11:return{TAG:1,_0:n._0,_1:n._1};case 15:var t=n._1,e=n._0;if(v.isLegalBinding(t))return{TAG:0,_0:e,_1:t};throw{RE_EXN_ID:m,_1:x(e,fr(r),t),Error:new Error};default:return lr(n,r)}}function mr(r){for(var n=Er(r),t=0;;){var e=t,a=_r(r);switch(0|a.TAG){case 17:t={hd:Er(r),tl:e};continue;case 19:return{_0:n,_1:i(e)};default:return lr(a,r)}}}function gr(r){switch(0|r.TAG){case 12:return!0;case 15:return"with"===r._1;default:return!1}}function wr(r){return 20===r.TAG}function br(r){return 12===r.TAG}function Nr(r,n,t){for(var e=r,a=0;;){var o=a,c=e;if(t(c))return[c,i(o)];switch(0|c.TAG){case 0:var u=c._1,s=_r(n);if(16===s.TAG){a={hd:{TAG:0,_0:u,_1:1},tl:o},e=_r(n);continue}a={hd:{TAG:0,_0:u,_1:3},tl:o},e=s;continue;case 11:a={hd:Lr(c._0,c._1,n),tl:o},e=_r(n);continue;case 15:var _=c._0;switch(c._1){case"map":var f=hr(n),A=yr(n,"map");a={hd:{TAG:4,_0:f[0],_1:f[1],_2:A},tl:o},e=_r(n);continue;case"match":a={hd:{TAG:3,_0:_,_1:pr(n),_2:yr(n,"match")},tl:o},e=_r(n);continue;case"raw":a={hd:{TAG:2,_0:_,_1:mr(n)},tl:o},e=_r(n);continue;default:return lr(c,n)}case 16:var d=_r(n);if(0!==d.TAG)return lr(d,n);var l=d._1,v=_r(n);if(16===v.TAG){a={hd:{TAG:0,_0:l,_1:2},tl:o},e=_r(n);continue}a={hd:{TAG:0,_0:l,_1:0},tl:o},e=v;continue;case 18:a={hd:{TAG:1,_0:c._0,_1:mr(n)},tl:o},e=_r(n);continue;case 1:case 19:e=_r(n);continue;default:return lr(c,n)}}}function kr(r){for(var n=Gr(r),t=0;;){var e=t,a=_r(r);if(15!==a.TAG||"with"!==a._1){var o=Nr(a,r,gr);return[o[0],{patterns:{_0:n,_1:i(e)},ast:o[1]}]}t={hd:Gr(r),tl:e}}}function yr(r,n){var t=_r(r);if(15!==t.TAG)return lr(t,r);if("with"!==t._1)return lr(t,r);for(var e=kr(r),a=e[1],o=e[0],c=0;;){var u=c;if(12===o.TAG){var s=_r(r);return 15===s.TAG&&s._1===n?{_0:a,_1:i(u)}:lr(s,r)}var _=kr(r);c={hd:_[1],tl:u},o=_[0]}}function Lr(r,n,t){var e=function(r,n,t,e){for(;;){var a=e,o=t,i=r;switch(0|i.TAG){case 11:var c=i._1,u=_r(n);if(14!==u.TAG){e={hd:[c,{TAG:0,_0:c}],tl:a},r=u;continue}var s=_r(n);switch(0|s.TAG){case 11:e={hd:[c,{TAG:0,_0:s._1}],tl:a},r=_r(n);continue;case 13:var _=Nr(_r(n),n,br),f=_r(n);if(13!==f.TAG)return lr(f,n);e={hd:[c,{TAG:1,_0:_[1]}],tl:a},r=_r(n);continue;default:return lr(s,n)}case 15:var A=i._1,d=_r(n);if(14===d.TAG){t={hd:[A,vr(_r(n),n)],tl:o},r=_r(n);continue}t={hd:[A,{TAG:8,_0:i._0,_1:A}],tl:o},r=d;continue;default:return[i,o,a]}}}(_r(t),t,0,0),a=e[2],o=e[1],i=e[0];if(12===i.TAG)return{TAG:5,loc:r,name:n,props:o,children:a};var c=Nr(i,t,br),u=_r(t);return 11===u.TAG&&n===u._1?{TAG:5,loc:r,name:n,props:o,children:{hd:["Children",{TAG:1,_0:c[1]}],tl:a}}:lr(u,t)}function xr(r,n){try{var t=function(r,n){for(var t={str:n,position:0},e={length:0,first:void 0,last:void 0},a=er(t,e);;)switch(a){case 0:var o=t.position;"~"===K(t)&&(z(e,{TAG:16,_0:t.position}),Q(t)),z(e,{TAG:18,_0:o}),ur(t,e,r,"}");var i=W(t);if("}"===i){a=er(t,e);continue}throw{RE_EXN_ID:m,_1:y(t.position,r,i,"}"),Error:new Error};case 1:ur(t,e,r,"%");var c=W(t);if("}"===c){a=er(t,e);continue}throw{RE_EXN_ID:m,_1:y(t.position,r,c,"}"),Error:new Error};case 2:z(e,{TAG:1,_0:t.position,_1:ar(t,r)}),a=er(t,e);continue;case 3:return z(e,{TAG:20,_0:t.position}),{tokens:e,name:r}}}(r,n),e=Nr(_r(t),t,wr);return p.make({NAME:"data",VAL:{ast:e[1],name:r}})}catch(n){var a=dr(n);return a.RE_EXN_ID===m?p.make({NAME:"errors",VAL:a._1}):p.make({NAME:"errors",VAL:C(a,r)})}}function Sr(n,t){if(t in n)return r(n[t])}function Vr(r){var n=typeof r;return"string"===n?{TAG:0,_0:r}:"number"===n?{TAG:1,_0:r}:"boolean"===n?!0===r?1:0:null===r?2:Array.isArray(r)?{TAG:3,_0:r}:{TAG:2,_0:r}}function $r(r,n){return 0===r.TAG?{TAG:0,_0:n(r._0)}:{TAG:1,_0:r._0}}function Ir(r,n){for(var t={length:0,first:void 0,last:void 0},e=r;;){var a=e;if(!a)return{TAG:0,_0:t};var o=n(a.hd);if(0!==o.TAG)return o;z(t,o._0),e=a.tl}}function Mr(r,t){switch(0|r.TAG){case 0:return{TAG:0,_0:null};case 1:return{TAG:0,_0:!1};case 2:return{TAG:0,_0:!0};case 3:case 4:return{TAG:0,_0:r._1};case 5:return $r(Ir(r._1,(function(r){return Mr(r,t)})),q);case 6:var e=r.binding,a=Sr(t,e);if(void 0===a)return{TAG:1,_0:{TAG:1,loc:r.bindLoc,binding:e}};var o=Vr(n(a));if("number"==typeof o)return{TAG:1,_0:{TAG:0,data:o,pattern:r,binding:e}};if(3!==o.TAG)return{TAG:1,_0:{TAG:0,data:o,pattern:r,binding:e}};var i=o._0;return $r(Ir(r.array,(function(r){return Mr(r,t)})),(function(r){return function(r,n){for(var t=r.length,e=n.length,a=new Array(t+e|0),o=0;o<t;++o)a[o]=r[o];for(var i=0;i<e;++i)a[t+i|0]=n[i];return a}(q(r),i)}));case 7:return $r(Ir(r._1,(function(r){var n=Mr(r[1],t);return 0===n.TAG?{TAG:0,_0:[r[0],n._0]}:n})),(function(r){var n={};return F(r,(function(r){n[r[0]]=r[1]})),n}));case 8:var c=r._1,u=Sr(t,c);return void 0!==u?{TAG:0,_0:n(u)}:{TAG:1,_0:{TAG:1,loc:r._0,binding:c}}}}function Rr(r,n,t,e){return"_"===n?{TAG:0,_0:r}:void 0!==Sr(r,n)?{TAG:1,_0:{TAG:1,loc:e,binding:n}}:(r[n]=t,{TAG:0,_0:r})}function Dr(r,t,e){var a=Vr(t);switch(0|r.TAG){case 0:return"number"==typeof a&&a>=2?{TAG:0,_0:e}:{TAG:1,_0:0};case 1:if("number"!=typeof a)return{TAG:1,_0:{TAG:0,data:a,pattern:r}};switch(a){case 0:return{TAG:0,_0:e};case 1:case 2:return{TAG:1,_0:0}}case 2:if("number"!=typeof a)return{TAG:1,_0:{TAG:0,data:a,pattern:r}};switch(a){case 1:return{TAG:0,_0:e};case 0:case 2:return{TAG:1,_0:0}}case 3:return"number"==typeof a?2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}}:0===a.TAG?r._1===a._0?{TAG:0,_0:e}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}};case 4:return"number"==typeof a?2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}}:1===a.TAG?r._1===a._0?{TAG:0,_0:e}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}};case 5:var o=r._1;return o?"number"==typeof a?2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}}:3===a.TAG?Pr(o,a._0,e,void 0):{TAG:1,_0:{TAG:0,data:a,pattern:r}}:"number"==typeof a?2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}}:3===a.TAG?0===a._0.length?{TAG:0,_0:e}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}};case 6:return"number"==typeof a?2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}}:3===a.TAG?Pr(r.array,a._0,e,[r.bindLoc,r.binding]):{TAG:1,_0:{TAG:0,data:a,pattern:r}};case 7:var i=r._1;if(!i)return"number"==typeof a?2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}}:2===a.TAG?0===Object.keys(a._0).length?{TAG:0,_0:e}:{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}};if("number"==typeof a)return 2===a?{TAG:1,_0:0}:{TAG:1,_0:{TAG:0,data:a,pattern:r}};if(2!==a.TAG)return{TAG:1,_0:{TAG:0,data:a,pattern:r}};for(var c=i,u=a._0;;){var s=c;if(!s)return{TAG:0,_0:e};var _=s.hd,f=Sr(u,_[0]);if(void 0===f)return{TAG:1,_0:0};var A=Dr(_[1],n(f),e);if(0!==A.TAG)return A;c=s.tl}case 8:return Rr(e,r._1,t,r._0)}}function Pr(r,a,o,i){for(var c=r,u=0;;){var s=u,_=c;if(!_)return void 0!==i?Rr(o,i[1],e(a,s),i[0]):{TAG:0,_0:o};var f=t(a,s);if(void 0===f)return{TAG:1,_0:0};var A=Dr(_.hd,n(f),o);if(0!==A.TAG)return A;u=s+1|0,c=_.tl}}function Or(r,n){for(var t={},e=_.toList(r),a=_.toList(n);;){var o=a,i=e;if(!i)return o?{TAG:1,_0:1}:{TAG:0,_0:t};if(!o)return{TAG:1,_0:1};var c=Dr(i.hd,o.hd,t);if(0!==c.TAG)return c;a=o.tl,e=i.tl}}function Xr(r,n){for(var t=r.f,e=_.toList(r.patterns);;){var a=e;if(!a)return{TAG:1,_0:0};var o=Or(a.hd,n);if(0===o.TAG)return{TAG:0,_0:t(o._0)};var i=o._0;if("number"!=typeof i)return o;if(0!==i)return o;e=a.tl}}function Cr(r,t){var e=Sr(r,t);return void 0!==e?n(e):null}function Br(r,n){var t=Vr(Cr(r,n));if("number"==typeof t)return{TAG:1,_0:t};switch(0|t.TAG){case 0:return{TAG:0,_0:t._0};case 1:return{TAG:0,_0:String(t._0)};default:return{TAG:1,_0:t}}}function jr(r){return function(n){return n._1?n:{_0:n._0,_1:{hd:{TAG:8,_0:r,_1:"_"},tl:0}}}}function Ur(r,n,t,e){var a=function(r,n){for(var t=_.toList(r);;){var e=t;if(!e)return{TAG:1,_0:0};var a=Xr(e.hd,n);if(0===a.TAG)return a;var o=a._0;if("number"!=typeof o)return a;if(0!==o)return a;t=e.tl}}(r,n);if(0===a.TAG)return a;var o=a._0;return"number"==typeof o?0===o?{TAG:1,_0:M(t,e)}:{TAG:1,_0:R(t,e)}:0===o.TAG?{TAG:1,_0:$(o.data,o.pattern,e)}:{TAG:1,_0:I(o.loc,o.binding,e)}}function zr(r){for(var n=0;;){var t=n;switch(r.charAt(t)){case"\t":case"\n":case"\r":case" ":n=t+1|0;continue;default:return r.slice(t)}}}function Zr(r){for(var n=r.length;;){var t=n;switch(r.charAt(t-1|0)){case"\t":case"\n":case"\r":case" ":n=t-1|0;continue;default:return r.slice(0,t)}}}function Fr(r,t,e,a,o,i,c){for(;;){var u=t,s=r;switch(0|s.TAG){case 0:var _=s._1,f=Br(e,_);if(0===f.TAG)return i(f._0);var A=f._0;if("number"==typeof A&&A>=2&&u){t=u.tl,r=u.hd;continue}return c([D(s._0,_,A,a)]);case 1:var d=s._1,l=Sr(o,d);if(void 0!==l)return n(l);if(!u)return c([P(s._0,d,a)]);t=u.tl,r=u.hd;continue;case 2:return i(s._0);case 3:return i(String(s._0))}}}function Jr(r,t,e,a,o,i,u,s){var f=a.stack,A=a.components,d=o(a),l={length:0,first:void 0,last:void 0},v=function(r){return d.return(function(r){for(var n=0,t="";;){var e=t,a=n,o=r.charAt(a);switch(o){case"":return e;case'"':t=e+"&quot;",n=a+1|0;continue;case"&":t=e+"&amp;",n=a+1|0;continue;case"'":t=e+"&apos;",n=a+1|0;continue;case"/":t=e+"&#x2F;",n=a+1|0;continue;case"<":t=e+"&lt;",n=a+1|0;continue;case"=":t=e+"&#x3D;",n=a+1|0;continue;case">":t=e+"&gt;",n=a+1|0;continue;case"`":t=e+"&#x60;",n=a+1|0;continue;default:t=e+o,n=a+1|0;continue}}}(r))};return c(r,(function(r){switch(0|r.TAG){case 0:var G,p=r._0;switch(r._1){case 0:G=zr(p);break;case 1:G=Zr(p);break;case 2:G=zr(Zr(p));break;case 3:G=p}return z(l,d.return(G));case 1:var m=r._1;return z(l,Fr(m._0,m._1,t,f,e,v,i));case 2:var g=r._1;return z(l,Fr(g._0,g._1,t,f,e,d.return,i));case 3:var w=Ur(_.map(r._2,(function(r){var n=r.ast;return{patterns:r.patterns,f:function(r){return Jr(n,Object.assign({},t,r),e,{components:a.components,stack:{hd:0,tl:f}},o,i,u,s)}}})),_.map(r._1,(function(r){return Cr(t,r[1])})),r._0,f);return 0===w.TAG?J(w._0,l):z(l,i([w._0]));case 4:var b=r._2,N=r._1,k=r._0,y=Vr(Cr(t,N));return"number"!=typeof y&&3===y.TAG?function(r,n){for(var t=0,e=r.length;t<e;++t)n(t,r[t])}(y._0,(function(r,n){var c=Ur(_.map(b,(function(n){var c=n.ast;return{patterns:_.map(n.patterns,jr(k)),f:function(n){return Jr(c,Object.assign({},t,n),e,{components:a.components,stack:{hd:{TAG:2,_0:r},tl:{hd:1,tl:f}}},o,i,u,s)}}})),{_0:n,_1:{hd:r,tl:0}},k,f);return 0===c.TAG?J(c._0,l):z(l,i([c._0]))})):z(l,i([O(k,N,y,f)]));case 5:var L=r.name,x=r.loc,$=Sr(A,L);if(void 0===$)return z(l,i([V(x,L,f)]));var I={},M={},R={length:0,first:void 0,last:void 0};return c(r.children,(function(r){var c=r[1],_=r[0];if(0===c.TAG){var A=c._0,d=Sr(e,A);return void 0!==d?void(M[_]=n(d)):z(R,P(x,A,f))}M[_]=s(Jr(c._0,t,e,{components:a.components,stack:{hd:{TAG:1,component:L,section:_},tl:f}},o,i,u,s))})),c(r.props,(function(r){var n=Mr(r[1],t);if(0!==n.TAG){var e=n._0;return 0===e.TAG?z(R,function(r,n,t,e){var a=S(r),o=h.toLocation(n);return{message:'"'+t+'" is type '+h.toString(n)+" but the data is type "+a+".",kind:"Type",location:T.$$location(o),path:E(e),exn:void 0}}(e.data,e.pattern,e.binding,f)):z(R,function(r,n,t){return{message:'Binding "'+n+'" does not exist.',kind:"Render",location:T.$$location(r),path:E(t),exn:void 0}}(e.loc,e.binding,f))}I[r[0]]=n._0})),Z(R)?z(l,u((function(){return $(d,I,M)}),(function(r){return i([B(r,f)])}))):z(l,i(q(R)))}})),l}function qr(r){return Promise.resolve({NAME:"data",VAL:r})}function Hr(r){return Promise.resolve({NAME:"errors",VAL:r})}function Kr(r,n){return r().catch((function(r){return n(r)}))}function Qr(r,n){return r.then((function(r){return"errors"===r.NAME?Promise.resolve(r):Promise.resolve({NAME:"data",VAL:n(r.VAL)})}))}function Wr(r,n){return r.then((function(r){return"errors"===r.NAME?Promise.resolve(r):n(r.VAL)}))}function Yr(r){var n={contents:""},t={length:0,first:void 0,last:void 0};return a(r,(function(r){return"errors"===r.NAME?a(r.VAL,(function(r){return z(t,r)})):void(n.contents=n.contents+r.VAL)})),Z(t)?Promise.resolve({NAME:"data",VAL:n.contents}):Promise.resolve({NAME:"errors",VAL:q(t)})}function rn(r){return Promise.all(q(r)).then(Yr)}function nn(r){var n=r.stack,t=r.components;return{render:function(r,e,a){var o=p.validate(r);if(void 0===o)return Promise.resolve({NAME:"errors",VAL:[X(n)]});if("errors"===o.NAME)return Promise.resolve({NAME:"errors",VAL:[o.VAL]});var i=o.VAL;return rn(Jr(i.ast,e,a,{components:t,stack:{hd:{TAG:0,_0:i.name},tl:n}},nn,Hr,Kr,rn))},return:qr,error:function(r){return Promise.resolve({NAME:"errors",VAL:[j(r,n)]})},mapChild:Qr,flatMapChild:Wr}}function tn(r){return{NAME:"data",VAL:r}}function en(r){return{NAME:"errors",VAL:r}}function an(r,n){try{return r()}catch(r){return n(dr(r))}}function on(r,n){return"errors"===r.NAME?r:{NAME:"data",VAL:n(r.VAL)}}function cn(r,n){return"errors"===r.NAME?r:n(r.VAL)}function un(r){var n={contents:""},t={length:0,first:void 0,last:void 0};return F(r,(function(r){return"errors"===r.NAME?a(r.VAL,(function(r){return z(t,r)})):void(n.contents=n.contents+r.VAL)})),Z(t)?{NAME:"data",VAL:n.contents}:{NAME:"errors",VAL:q(t)}}function sn(r){var n=r.stack,t=r.components;return{render:function(r,e,a){var o=p.validate(r);if(void 0===o)return{NAME:"errors",VAL:[X(n)]};if("errors"===o.NAME)return{NAME:"errors",VAL:[o.VAL]};var i=o.VAL;return un(Jr(i.ast,e,a,{components:t,stack:{hd:{TAG:0,_0:i.name},tl:n}},sn,en,an,un))},return:tn,error:function(r){return{NAME:"errors",VAL:[j(r,n)]}},mapChild:on,flatMapChild:cn}}var _n={make:function(r){return nn({components:r,stack:0})}},fn={makeAst:function(r,n){return xr(n,r)},make:function(r,n){return function(r,n){var t=xr(r,n);return function(r,n,e){return r.render(t,n,e)}}(n,r)}},An=Object.freeze({__proto__:null,Async:_n,make:function(r){return sn({components:r,stack:0})}});export{fn as Compile,An as Environment};
//# sourceMappingURL=acutis.mjs.map
